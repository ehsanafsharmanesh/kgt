<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุทุฑุญ ุงุณุชุงู ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          emailjs.init("VZYbSfsVjY-B4rsyE");
       })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">

    <style>
        /* --- ุชูุธูุงุช ูพุงู --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary-color: #2e7d32;
            --primary-dark: #1b5e20;
            --primary-light: #4caf50;
            --secondary-color: #ffd54f;
            --accent-color: #ff6f00;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --background: #f0fdf4;
            --white: #ffffff;
            --shadow-soft: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Vazirmatn', sans-serif; /* ูููุช ุฌุฏุฏ ู ุงุณุชุงูุฏุงุฑุฏ */
            background: var(--background);
            color: var(--text-dark);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- ููุงุฑ ูุงูุจุฑ --- */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed; top: 0; width: 100%; z-index: 1000;
            padding: 0.8rem 0; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .nav-container {
            max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .nav-logo { font-weight: 800; font-size: 1.4rem; color: var(--primary-dark); display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background: #f1f8e9;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid #dcedc8;
        }

        .nav-link { 
            color: var(--text-dark); text-decoration: none; font-weight: 600; 
            font-size: 0.95rem; padding: 0.5rem 1rem; border-radius: 25px; 
            transition: all 0.3s; position: relative; cursor: pointer; white-space: nowrap;
        }
        .nav-link:hover { color: var(--primary-dark); background: rgba(76, 175, 80, 0.1); transform: translateY(-1px); }
        .nav-link.active-tab { background: var(--primary-color); color: white; box-shadow: 0 4px 10px rgba(46,125,50,0.3); }
        
        .nav-btn { 
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
            color: white; padding: 0.6rem 1.8rem; border-radius: 25px; 
            border: none; cursor: pointer; font-family: inherit; font-weight: 700;
            box-shadow: 0 4px 15px rgba(27, 94, 32, 0.3); transition: all 0.3s; white-space: nowrap;
        }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(27, 94, 32, 0.4); }
        .nav-btn:disabled { background: #ccc; transform: none; box-shadow: none; cursor: not-allowed; }

        /* --- ุณุงุฎุชุงุฑ ฺฉู ุตูุญุงุช --- */
        .main-section { display: none; padding-top: 100px; min-height: 100vh; animation: fadeIn 0.6s ease; }
        .main-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

        /* --- ูุฑู (Hero) --- */
        .hero {
            background: radial-gradient(circle at 10% 20%, rgb(27, 94, 32) 0%, rgb(46, 125, 50) 90%);
            color: white; padding: 4rem 0 8rem; position: relative;
            border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;
            margin-top: -100px; padding-top: 180px;
        }
        .hero-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 4rem; align-items: center; }
        .hero-title { font-size: 3rem; font-weight: 900; line-height: 1.3; margin-bottom: 1.5rem; }
        .title-accent { display: block; color: var(--secondary-color); text-shadow: 0 0 20px rgba(255, 213, 79, 0.3); }
        .hero-desc { font-size: 1.1rem; opacity: 0.9; line-height: 1.8; margin-bottom: 2rem; max-width: 600px; }
        
        .stat-cards-hero { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 3rem; }
        .hero-stat-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 16px; padding: 1rem; text-align: center; transition: transform 0.3s; }
        .hero-stat-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.2); }
        .hero-stat-val { font-size: 1.5rem; font-weight: bold; display: block; margin-bottom: 0.2rem; }
        .hero-stat-lbl { font-size: 0.8rem; opacity: 0.8; }

        /* --- ุงููุดู ุฏุฑุฎุช ูุงู (Live Tree) --- */
        .tree-container-hero { position: relative; width: 300px; height: 350px; margin: 0 auto; }
        .live-tree-trunk { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 40px; height: 0; background: linear-gradient(90deg, #5D4037, #8D6E63); border-radius: 10px; z-index: 2; animation: growTrunk 1s forwards ease-out; }
        .live-tree-layer { position: absolute; left: 50%; transform: translateX(-50%) scale(0); border-radius: 50% 50% 50% 0; transform-origin: center bottom; box-shadow: 0 10px 20px rgba(0,0,0,0.2); opacity: 0; }
        .layer-1 { width: 220px; height: 90px; bottom: 60px; background: #2E7D32; z-index: 5; animation: growLayer 0.8s forwards 0.8s; }
        .layer-2 { width: 180px; height: 80px; bottom: 110px; background: #388E3C; z-index: 6; animation: growLayer 0.8s forwards 1.6s; }
        .layer-3 { width: 140px; height: 70px; bottom: 160px; background: #43A047; z-index: 7; animation: growLayer 0.8s forwards 2.4s; }
        .layer-4 { width: 100px; height: 60px; bottom: 210px; background: #4CAF50; z-index: 8; animation: growLayer 0.8s forwards 3.2s; }
        .layer-5 { width: 60px; height: 50px; bottom: 250px; background: #66BB6A; z-index: 9; animation: growLayer 0.8s forwards 4.0s; }
        @keyframes growTrunk { to { height: 80px; } }
        @keyframes growLayer { 
            0% { transform: translateX(-50%) scale(0) rotate(-45deg); opacity: 0; }
            70% { transform: translateX(-50%) scale(1.1) rotate(0deg); opacity: 1; }
            100% { transform: translateX(-50%) scale(1) rotate(0deg); opacity: 1; }
        }
        
        /* ูุดุงูฺฏุฑ ุถุฑุจ ุฏุฑุฎุช (ุจุฑุง ุจุด ุงุฒ 500 ฺฉูู) */
        .tree-multiplier-badge {
            position: absolute; top: 10px; right: 10px;
            background: var(--secondary-color); color: var(--text-dark);
            font-weight: 900; padding: 5px 15px; border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 100; font-size: 1.2rem;
            animation: bounceIn 0.8s;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* --- ุจุฎุด ุฌูุงุฒ --- */
        .awards-section {
            padding: 0; position: relative; margin-top: -60px; margin-bottom: 4rem; z-index: 10;
        }
        .section-header-awards {
            text-align: center; margin-bottom: 2rem;
            /* ุงุตูุงุญ ูพุณโุฒููู ุชุงุชู ุฌูุงุฒ ุจุฑุง ุฎูุงูุง */
            display: table; /* ุจุฑุง ุงูฺฉู ุจุงฺฉุณ ููุท ุจู ุงูุฏุงุฒู ูุญุชูุง ุนุฑุถ ุจฺฏุฑุฏ */
            margin: 0 auto; /* ูุณุท ฺู ฺฉุฑุฏู ุจุงฺฉุณ ุฏุฑ ุตูุญู ุฏุณฺฉุชุงูพ */
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: inline-block;
            padding: 1rem 2rem;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            /* ุญุฐู ุฎุตูุตุงุช position/transform ฺฉู ุฏุฑ ุฏุณฺฉุชุงูพ ุชุฏุงุฎู ุงุฌุงุฏ ูโฺฉุฑุฏูุฏ */
           position: static;
           transform: none;
        }
        .section-header-awards h2 { font-size: 2rem; margin-bottom: 0.5rem; color: var(--primary-dark); }
        .section-header-awards p { opacity: 0.9; color: var(--primary-dark); font-weight: 500; }

        .awards-slider {
            max-width: 1000px; margin: 0 auto; position: relative; border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); background: var(--white);
            overflow: hidden; height: 450px;
        }
        .slides-container {
            display: flex; height: 100%; transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
        }
        .award-slide {
            min-width: 100%; height: 100%; position: relative; display: flex;
            align-items: flex-end; justify-content: center; overflow: hidden;
        }
        .slide-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; transition: transform 6s ease;
        }
        .award-slide.active .slide-bg { transform: scale(1.1); }
        .slide-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(27, 94, 32, 0.6) 50%, rgba(0,0,0,0.2) 100%);
            z-index: 1;
        }
        .award-content {
            position: relative; z-index: 2; text-align: center; padding: 3rem; color: white;
            width: 100%; transform: translateY(20px); opacity: 0; transition: all 0.5s ease 0.3s;
        }
        .award-slide.active .award-content { transform: translateY(0); opacity: 1; }
        
        .award-icon-box {
            width: 80px; height: 80px; background: var(--secondary-color); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 2.5rem;
            margin: 0 auto 1.5rem; box-shadow: 0 0 20px rgba(255, 213, 79, 0.6);
            border: 4px solid rgba(255,255,255,0.3);
        }
        .award-title { font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--secondary-color); }
        .award-description { font-size: 1.1rem; margin-bottom: 1.5rem; color: #e0e0e0; }
        .award-prize-tag {
            display: inline-block; background: rgba(255,255,255,0.15); backdrop-filter: blur(5px);
            border: 1px solid var(--secondary-color); padding: 0.8rem 2rem; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem; color: white;
        }
        .slider-arrow {
            position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px;
            border-radius: 50%; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px);
            border: none; color: white; font-size: 1.5rem; cursor: pointer; z-index: 10; transition: all 0.3s;
        }
        .slider-arrow:hover { background: var(--white); color: var(--primary-color); transform: translateY(-50%) scale(1.1); }
        .arrow-prev { right: 20px; }
        .arrow-next { left: 20px; }
        .slider-nav {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 0.8rem; z-index: 10;
        }
        .nav-dot {
            width: 12px; height: 12px; background: rgba(255, 255, 255, 0.4);
            border-radius: 50%; cursor: pointer; transition: all 0.3s;
        }
        .nav-dot.active { background: var(--secondary-color); width: 30px; border-radius: 10px; }

        /* --- ููุชุฑ --- */
        .footer { background: #1b1b1b; color: #fff; padding: 3rem 0; margin-top: 4rem; text-align: center; border-top: 5px solid var(--primary-color); }
        .footer-links { display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .footer-link { color: #ccc; text-decoration: none; font-size: 1rem; transition: color 0.3s; }
        .footer-link:hover { color: var(--secondary-color); }
        .footer-copy { border-top: 1px solid #333; padding-top: 1.5rem; font-size: 0.9rem; color: #888; }

        /* --- ุงุณุชุงู ูุดุชุฑฺฉ ุตูุญุงุช ุฏุงุฎู --- */
        .page-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            color: white; padding: 3rem 0; border-radius: 20px; margin-bottom: 2rem;
            position: relative; overflow: hidden; box-shadow: var(--shadow-soft);
        }
        .page-header::after { content: ''; position: absolute; right: 0; bottom: 0; width: 300px; height: 300px; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='rgba(255, 255, 255, 0.1)' d='M44.7,-76.4C58.9,-69.2,71.8,-59.1,81.6,-46.6C91.4,-34.1,98.1,-19.2,95.8,-5.3C93.5,8.6,82.2,21.5,70.9,32.2C59.6,42.9,48.3,51.4,36.4,58.5C24.5,65.6,12,71.3,-1.2,73.4C-14.4,75.5,-29.8,74,-43.3,67.6C-56.8,61.2,-68.4,49.9,-76.3,36.4C-84.2,22.9,-88.4,7.2,-86.3,-7.5C-84.2,-22.2,-75.8,-35.9,-65.1,-46.8C-54.4,-57.7,-41.4,-65.8,-28.3,-73.6C-15.2,-81.4,-2,-88.9,12.2,-89.8C26.4,-90.7,40.8,-85,44.7,-76.4Z' transform='translate(100 100)' /%3E%3C/svg%3E") no-repeat bottom right; background-size: contain; }
        
        /* ฺฉุงุฑุชโูุง ูุฏุฑู ู ุฌุฏุงูู */
        .stats-cards-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .modern-card { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; display: flex; flex-direction: column; align-items: center; }
        .modern-card h3 { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .modern-card .value { font-size: 1.8rem; font-weight: bold; color: var(--primary-dark); }
        .modern-card .icon { font-size: 2rem; margin-bottom: 0.5rem; background: #e8f5e9; padding: 10px; border-radius: 50%; }
        .modern-table-container { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-x: auto; }
        .modern-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .modern-table th { text-align: right; padding: 1rem; color: var(--text-light); font-weight: 600; border-bottom: 2px solid #f0f0f0; }
        .modern-table td { padding: 1rem; border-bottom: 1px solid #f0f0f0; color: var(--text-dark); }
        .modern-table tr:hover { background: #f9fafb; }
        .rank-badge { background: var(--secondary-color); color: var(--primary-dark); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; }
        
        .tabs { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .tab-btn { padding: 0.8rem 2rem; border-radius: 50px; border: none; background: white; color: var(--text-light); cursor: pointer; font-weight: 600; font-family: inherit; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: all 0.3s; }
        .tab-btn.active { background: var(--primary-color); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46,125,50,0.3); }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        /* --- ูพุฑููุงูโูุง --- */
        .school-profile-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        
        .progress-circle-container { position: relative; width: 200px; height: 200px; margin: 0 auto; }
        .progress-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .progress-circle-bg { fill: none; stroke: #e0e0e0; stroke-width: 10; }
        .progress-circle-fg { fill: none; stroke: var(--primary-color); stroke-width: 10; stroke-dasharray: 565; stroke-dashoffset: 565; transition: stroke-dashoffset 1.5s ease-out; stroke-linecap: round; filter: drop-shadow(0 0 5px var(--primary-color)); }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        
        .forest-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; background: #e8f5e9; padding: 2rem; border-radius: 20px; min-height: 200px; max-height: 400px; overflow-y: auto; }
        .forest-tree-item { font-size: 2.5rem; text-align: center; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; transform: scale(0); }
        @keyframes popIn { to { opacity: 1; transform: scale(1); } }

        /* --- ูุฑู ุฏุณุชุฑุณ (ุจุฑูุฒ ุดุฏู ุจุฑุง OTP) --- */
        .access-card { background: white; max-width: 400px; margin: 2rem auto; padding: 2rem; border-radius: 20px; box-shadow: var(--shadow-soft); text-align: center; }
        .access-input { width: 100%; padding: 1rem; border: 2px solid #eee; border-radius: 10px; margin: 1rem 0; font-family: inherit; outline: none; transition: border 0.3s; text-align: center; direction: ltr; }
        .access-input:focus { border-color: var(--primary-color); }
        /* ูพูู ูุฏุฑุช: ฺฉ ุณุชูู ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ฺฉู */
        .upload-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 2rem; }
        .upload-box { border: 2px dashed #cbd5e1; padding: 1.5rem; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: #f8fafc; }
        .upload-box:hover { border-color: var(--primary-color); background: #f0fdf4; }

        /* --- ุงุตูุงุญุงุช ุฑุณูพุงูุณู (ููุจุงู ูุฑูุฏู) --- */
        @media (max-width: 768px) {
            .navbar { padding: 0.5rem 0; }
            /* ุงุณฺฉุฑูู ุงูู ุจุฑุง ููู ุฏุฑ ููุจุงู */
            .nav-menu { 
                overflow-x: auto; 
                white-space: nowrap; 
                padding: 0.5rem; 
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* ูุงุฑูุงฺฉุณ */
            }
            .nav-menu::-webkit-scrollbar { display: none; } /* ฺฉุฑูู ู ุณุงูุงุฑ */
            
            .hero-content { grid-template-columns: 1fr; text-align: center; gap: 2rem; }
            .hero-content > div:first-child { order: 2; }
            .tree-container-hero { order: 1; transform: scale(0.9); margin: 0 auto; }
            .stat-cards-hero { grid-template-columns: 1fr 1fr; }
            .hero-title { font-size: 2rem; }
            
            .school-profile-grid { grid-template-columns: 1fr; }
            .stats-cards-row { grid-template-columns: 1fr; }
            
            .section-header-awards h2 { font-size: 1.5rem; }
            .awards-slider { height: 500px; }
            .award-content { padding: 1.5rem; }
            .award-title { font-size: 1.5rem; }
            
            .modern-table th, .modern-table td { padding: 0.8rem 0.5rem; font-size: 0.9rem; }
        }

    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo" onclick="showSection('home')">
                <span style="font-size: 1.8rem;">๐ณ</span>
                <span style="display: inline-block;">ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู</span>
            </div>
            <div class="nav-menu">
                <a class="nav-link active-tab" onclick="showSection('home')">ุฎุงูู</a>
                <a class="nav-link" onclick="scrollToAwards()">ุฌูุงุฒ</a>
                <a class="nav-link" onclick="showSection('stats')">ุขูุงุฑ ุงุณุชุงู</a>
                <a class="nav-link" onclick="showSection('school')">ูพุฑููุงู ูุฏุฑุณู</a>
                <a class="nav-link" onclick="showSection('office')">ูพุฑููุงู ุงุฏุงุฑู</a>
                <button class="nav-btn" onclick="showSection('access')">ูุฏุฑุช</button>
            </div>
        </div>
    </nav>

    <section id="home" class="main-section active">
        <div class="hero">
            <div class="container">
                <div class="hero-content">
                    <div>
                        <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                            ๐ฑ ุทุฑุญ ุฒุณุช ูุญุท ฑดฐด
                        </span>
                        <h1 class="hero-title">ูุฑ ูุฏุฑุณูุ ูุฌุงุช ฺฉ ุฏุฑุฎุช<span class="title-accent">ุขูุฏูโุง ุณุจุฒ ุจุฑุง ฺฉุฑูุงู</span></h1>
                        <p class="hero-desc">ุทุฑุญ ุจุฒุฑฺฏ ุฌูุนโุขูุฑ ูพุณูุงูุฏูุง ุจุง ุงุฑุฒุด ุฏุฑ ูุฏุงุฑุณ ุงุณุชุงู ฺฉุฑูุงู. ุจุง ูุดุงุฑฺฉุช ุฏุฑ ุงู ุทุฑุญุ ุนูุงูู ุจุฑ ุชุฌูุฒ ูุฏุฑุณู ุฎูุฏุ ุจู ุญูุธ ุฌูฺฏูโูุง ุงุฑุงู ฺฉูฺฉ ฺฉูุฏ.</p>
                        
                        <div class="stat-cards-hero">
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="totalActiveSchools">0</span>
                                <span class="hero-stat-lbl">ูุฏุฑุณู ูุนุงู</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="totalTreesSaved">0</span>
                                <span class="hero-stat-lbl">ุฏุฑุฎุช ูุฌุงุชโุงูุชู</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="topOfficeNameHero">-</span>
                                <span class="hero-stat-lbl">ุงุฏุงุฑู ุจุฑุชุฑ</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="topSchoolNameHero">-</span>
                                <span class="hero-stat-lbl">ูุฏุฑุณู ุจุฑุชุฑ</span>
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button class="nav-btn" style="background: var(--secondary-color); color: var(--primary-dark); font-weight: bold; padding: 1rem 2rem;" onclick="showSection('school')">ูุฑูุฏ ุจู ูพูู ูุฏุฑุณู</button>
                        </div>
                    </div>

                    <div class="tree-container-hero">
                        <div class="live-tree-trunk"></div>
                        <div class="live-tree-layer layer-1"></div>
                        <div class="live-tree-layer layer-2"></div>
                        <div class="live-tree-layer layer-3"></div>
                        <div class="live-tree-layer layer-4"></div>
                        <div class="live-tree-layer layer-5"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="awards-section" id="awards-anchor">
            <div class="container">
                <div class="section-header-awards">
                    <h2>ุฌุดููุงุฑู ุฌูุงุฒ ุจุฒุฑฺฏ ุณุจุฒ</h2>
                    <p>ุชูุฏุฑ ุงุฒ ุชูุงุดฺฏุฑุงู ุญูุธ ูุญุท ุฒุณุช ุจุง ุฌูุงุฒ ููุณ</p>
                </div>
                
                <div class="awards-slider" id="awardsSlider">
                    <div class="slides-container" id="slidesContainer">
                        
                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1560785496-4c97b98d2c0b?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐ฅ๏ธ</div>
                                <h3 class="award-title">ุชุฌูุฒ ููุดููุฏ ูุฏุงุฑุณ</h3>
                                <p class="award-description">ุชุฎุชู ููุดููุฏุ ูุฏุฆู ูพุฑูฺฺฉุชูุฑ ู ููพโุชุงูพ ุจุฑุง ูุฏุงุฑุณ ุจุฑุชุฑ ุฏุฑ ุฌูุนโุขูุฑ ฺฉุงุบุฐ</p>
                                <div class="award-prize-tag">ูฺู ณ ูุฏุฑุณู ุงูู ุงุณุชุงู</div>
                            </div>
                        </div>

                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1517649763962-0c623066013b?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐ฒ</div>
                                <h3 class="award-title">ุชุฌูุฒุงุช ูุฑุฒุด ู ุณูุงูุช</h3>
                                <p class="award-description">ุงูุฏุง ุฏูฺุฑุฎู ฺฉููุณุชุงู ู ุณุช ฺฉุงูู ูุฑุฒุด ุจู ุฏุงูุดโุขููุฒุงู ูุนุงู</p>
                                <div class="award-prize-tag">ูุฑุนูโฺฉุด ุจู ตฐ ุฏุงูุดโุขููุฒ ุจุฑุชุฑ</div>
                            </div>
                        </div>

                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">โ๏ธ</div>
                                <h3 class="award-title">ุณูุฑ ุชูุฑุญ ุดูุงู</h3>
                                <p class="award-description">ุชูุฑ ด ุฑูุฒู ุชูุฑุญ ุจู ุงุณุชุงูโูุง ุดูุงู ุจุฑุง ฺฉุงุฏุฑ ุงุฌุฑุง ูุฏุงุฑุณ ููููู</p>
                                <div class="award-prize-tag">ูฺู ูุฏุฑุงู ู ูุนุงููู ุจุฑุชุฑ</div>
                            </div>
                        </div>

                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1627931398857-e685f4039365?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐</div>
                                <h3 class="award-title">ุชูุฏุณ ุฒุฑู ุญุงูุธ ูุญุท ุฒุณุช</h3>
                                <p class="award-description">ูุดุงู ุฑุณู ู ุชูุฏุฑูุงูู ุจุง ุงูุถุง ูุฏุฑฺฉู ูุญุชุฑู + ุงุนุชุจุงุฑ ููุฏ</p>
                                <div class="award-prize-tag">ูุนุชุจุฑุชุฑู ูุดุงู ุงุณุชุงู</div>
                            </div>
                        </div>

                    </div>
                    
                    <button class="slider-arrow arrow-prev" onclick="changeSlide(-1)">โฎ</button>
                    <button class="slider-arrow arrow-next" onclick="changeSlide(1)">โฏ</button>
                    
                    <div class="slider-nav" id="sliderNav">
                        <div class="nav-dot active" onclick="goToSlide(0)"></div>
                        <div class="nav-dot" onclick="goToSlide(1)"></div>
                        <div class="nav-dot" onclick="goToSlide(2)"></div>
                        <div class="nav-dot" onclick="goToSlide(3)"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="stats" class="main-section">
        <div class="container">
            <div class="page-header">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <h1>ุขูุงุฑ ุฌุงูุน ุงุณุชุงู</h1>
                    <p>ฺฏุฒุงุฑุด ูุญุธูโุง ุนููฺฉุฑุฏ ูุฏุงุฑุณ ู ุงุฏุงุฑุงุช ุงุณุชุงู ฺฉุฑูุงู</p>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('schools-rank')">ุฑุชุจูโุจูุฏ ูุฏุงุฑุณ</button>
                <button class="tab-btn" onclick="switchTab('offices-rank')">ุฑุชุจูโุจูุฏ ุงุฏุงุฑุงุช</button>
            </div>

            <div id="schools-rank" class="tab-content active">
                <div class="modern-table-container">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>ุฑุชุจู</th>
                                <th>ูุงู ูุฏุฑุณู</th>
                                <th>ููุทูู (ุงุฏุงุฑู)</th>
                                <th>ุฌูุนโุขูุฑ (kg)</th>
                                <th>ูุถุนุช</th>
                            </tr>
                        </thead>
                        <tbody id="schoolsTableBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="offices-rank" class="tab-content">
                <div class="modern-table-container">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>ุฑุชุจู</th>
                                <th>ูุงู ุงุฏุงุฑู</th>
                                <th>ุชุนุฏุงุฏ ูุฏุงุฑุณ ูุนุงู</th>
                                <th>ฺฉู ุฌูุนโุขูุฑ (kg)</th>
                                <th>ุนููฺฉุฑุฏ</th>
                            </tr>
                        </thead>
                        <tbody id="officesTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section id="school" class="main-section">
        <div class="container">
            <div class="page-header">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <span style="background: var(--secondary-color); color: var(--primary-dark); padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">ูพุฑููุงู ูุฏุฑุณู ุจุฑุชุฑ</span>
                    <h1 id="schoolProfileName" style="margin-top: 10px;">-</h1>
                    <p id="schoolProfileRegion">- | ฺฉุฏ: -</p>
                </div>
            </div>

            <div class="school-profile-grid">
                <div class="modern-card">
                    <h3>ูุถุนุช ุฏุฑุฎุช ูุฏุฑุณู</h3>
                    <div class="tree-container-hero" style="transform: scale(0.8); height: 280px; position: relative;">
                        <div id="treeMultiplierBadge" class="tree-multiplier-badge" style="display: none;"></div>
                        
                        <div class="live-tree-trunk"></div>
                        <div class="live-tree-layer layer-1" id="sl-1"></div>
                        <div class="live-tree-layer layer-2" id="sl-2"></div>
                        <div class="live-tree-layer layer-3" id="sl-3"></div>
                        <div class="live-tree-layer layer-4" id="sl-4"></div>
                        <div class="live-tree-layer layer-5" id="sl-5"></div>
                    </div>
                    <p style="color: var(--primary-color); font-weight: bold; margin-top: 1rem;" id="treeStatusText">ุดูุง ุฏุฑ ุญุงู ูุฌุงุช ฺฉ ุฏุฑุฎุช ูุณุชุฏ!</p>
                </div>

                <div class="modern-card">
                    <div class="progress-circle-container">
                        <svg class="progress-svg">
                            <circle class="progress-circle-bg" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-circle-fg" id="schoolProgressCircle" cx="100" cy="100" r="90"></circle>
                        </svg>
                        <div class="progress-text">
                            <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-color);" id="schoolPercentText">0%</div>
                            <div style="color: #888; font-size: 0.9rem;">ูพุดุฑูุช (ุฏุฑุฎุช ูุนู)</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; margin-top: 2rem;">
                        <div style="text-align: center; background: #f9f9f9; padding: 1rem; border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: #888;">ูุฒู ุฌูุนโุขูุฑ ุดุฏู</div>
                            <div style="font-size: 1.2rem; font-weight: bold;" id="schoolWeightText">0 kg</div>
                        </div>
                        <div style="text-align: center; background: #f9f9f9; padding: 1rem; border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: #888;">ุฑุชุจู ุฏุฑ ุงุณุชุงู</div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--secondary-color);" id="schoolRankText">-</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; width: 100%; padding: 1rem; background: #fff3cd; border-radius: 10px; font-size: 0.9rem; color: #856404;">
                        ๐ก <strong>ูฺฉุชู:</strong> ูุฑ ตฐฐ ฺฉููฺฏุฑู ฺฉุงุบุฐ ูุนุงุฏู ูุฌุงุช ฺฉ ุฏุฑุฎุช ุงุณุช.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="office" class="main-section">
        <div class="container">
            <div class="page-header" style="background: linear-gradient(135deg, #1b5e20, #004d40);">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <span style="background: white; color: #004d40; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">ุงุฏุงุฑู ูพุดุชุงุฒ</span>
                    <h1 id="officeProfileName" style="margin-top: 10px;">-</h1>
                    <p id="officeProfileStats">ูุฏุงุฑุณ ูุนุงู: 0 | ฺฉู ฺฉุงุบุฐ: 0 kg</p>
                </div>
            </div>

            <div class="stats-cards-row">
                <div class="modern-card">
                    <div class="icon">๐ฒ</div>
                    <h3>ุฌูฺฏู ุงุฌุงุฏ ุดุฏู</h3>
                    <div class="value" id="officeTreeCount">0</div>
                </div>
                <div class="modern-card">
                    <div class="icon">โ๏ธ</div>
                    <h3>ูุงูฺฏู ูุฑ ูุฏุฑุณู</h3>
                    <div class="value" id="officeAvgWeight">0 kg</div>
                </div>
                <div class="modern-card">
                    <div class="icon">๐ฅ</div>
                    <h3>ุฑุชุจู ุงุณุชุงู</h3>
                    <div class="value" id="officeRank">1</div>
                </div>
            </div>

            <h2 style="margin: 2rem 0 1rem; color: var(--primary-dark);">ุฌูฺฏู ูุฌุงุฒ ุงุฏุงุฑู</h2>
            <div class="forest-grid" id="officeForestGrid">
                </div>
        </div>
    </section>

    <section id="access" class="main-section">
        <div class="container">
            <div class="access-card" id="loginCard">
                <h2 style="margin-bottom: 1rem;">ูุฑูุฏ ุงูู ูุฏุฑุงู</h2>
                <p style="color: #666; margin-bottom: 2rem;">ุจุฑุง ุฏุฑุงูุช ุฑูุฒ ุนุจูุฑ ฺฉุจุงุฑ ูุตุฑูุ ุงูู ูุฌุงุฒ ุฑุง ูุงุฑุฏ ฺฉูุฏ.</p>
                
                <div id="emailStep">
                    <input type="email" class="access-input" id="emailInput" placeholder="example@email.com">
                    <button class="nav-btn" onclick="requestOTP()" style="width: 100%; padding: 1rem;">ุงุฑุณุงู ฺฉุฏ ุชุงุฏ</button>
                </div>

                <div id="otpStep" style="display: none;">
                    <p style="color: var(--primary-color); font-weight: bold; margin-bottom: 10px;">ฺฉุฏ ุงุฑุณุงู ุดุฏู ุจู ุงูู ุฑุง ูุงุฑุฏ ฺฉูุฏ</p>
                    <input type="text" class="access-input" id="otpInput" placeholder="_ _ _ _ _" maxlength="5">
                    <button class="nav-btn" onclick="verifyOTP()" style="width: 100%; padding: 1rem;">ุชุงุฏ ู ูุฑูุฏ</button>
                    <button onclick="resetLogin()" style="margin-top: 1rem; background: none; border: none; color: #666; cursor: pointer; text-decoration: underline;">ุชุบุฑ ุงูู</button>
                </div>
            </div>

            <div id="adminPanel" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 2rem;">ูพูู ูุฏุฑุช ุฏุงุฏูโูุง</h2>
                <div class="upload-grid">
                    <div class="upload-box" onclick="document.getElementById('mainFile').click()">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">๐</div>
                        <h3>ุจุงุฑฺฏุฐุงุฑ ูุงู ฺฉู (ุงฺฉุณู)</h3>
                        <p style="color: #888; font-size: 0.9rem;">ุดุงูู ฺฉุฏุ ูุงู ูุฏุฑุณูุ ูุฒู ู ุฑุชุจู (ุชูฺฉฺฉ ุฎูุฏฺฉุงุฑ)</p>
                        <input type="file" id="mainFile" hidden accept=".xlsx, .xls">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                     <button class="nav-btn" onclick="exportData()" style="background: #1b5e20;">๐ฅ ุฎุฑูุฌ ุงฺฉุณู ุงุฒ ุณุงุช</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="#" onclick="showSection('home')" class="footer-link">ุตูุญู ุงุตู</a>
                <a href="#" onclick="showSection('stats')" class="footer-link">ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง</a>
                <a href="#" onclick="showSection('access')" class="footer-link">ูพูู ูุฏุฑุช</a>
                <a href="mailto:kermangreentree@gmail.com" class="footer-link">ุงุฑุชุจุงุท ุจุง ูุง</a>
                </div>
            <div class="footer-copy">
                &copy; ฑดฐด ุทุฑุญ ุงุณุชุงู ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู. ุชูุงู ุญููู ูุญููุธ ุงุณุช.
            </div>
        </div>
    </footer>

    <script>
        // --- ุฏฺฉุดูุฑ ูุงู ููุงุทู (ุทุจู ูุงู ุงฺฉุณู ู ุฏุฑุฎูุงุณุช ุดูุง ุงุฒ ุงุฑุฒูุฆู ุชุง ููู) ---
        // ฺฉุฏูุง ุจุงุฏ ุฏู ุฑูู ุจุงุดูุฏ (01, 02, ...)
        const regionNames = {
            "01": "ุงุฑุฒูุฆู",
            "02": "ุงูุงุฑ",
            "03": "ุจุงูุช",
            "04": "ุจุฑุฏุณุฑ",
            "05": "ุจู",
            "06": "ุฌุฑูุช",
            "07": "ุฑุงุจุฑ",
            "08": "ุฑุงูุฑ",
            "09": "ุฑูุณูุฌุงู",
            "10": "ุฑูุฏุจุงุฑ ุฌููุจ",
            "11": "ุฑฺฏุงู",
            "12": "ุฒุฑูุฏ",
            "13": "ุณุฑุฌุงู",
            "14": "ุดูุฑุจุงุจฺฉ",
            "15": "ุนูุจุฑุขุจุงุฏ",
            "16": "ููุฑุฌ",
            "17": "ูุงุฑุงุจ",
            "18": "ููุนู ฺฏูุฌ",
            "19": "ฺฉูููุฌ",
            "20": "ฺฉููุจูุงู",
            "21": "ูููุฌุงู",
            "22": "ูุฑูุงุดุฑ",
            "23": "ูุงุญู ฑ ฺฉุฑูุงู",
            "24": "ูุงุญู ฒ ฺฉุฑูุงู",
            "25": "ฺุชุฑูุฏ",
            "26": "ุฑุงู",
            "27": "ุดูุฏุงุฏ",
            "28": "ฺฏูุจุงู",
            "29": "ูุงูุงู",
            "30": "ููู",
            "31": "ฺฉุดฺฉูุฆู",
            "32": "ุณุฑฺ",
            "33": "ุฎุฑุขุจุงุฏ" // ุงฺฏุฑ ูุงู ููุทูู 33 ูุชูุงูุช ุงุณุชุ ุงูุฌุง ุฑุง ูุฑุงุด ฺฉูุฏ
        };

        // --- ุฏุงุฏูโูุง ูพุดโูุฑุถ ---
        let appData = {
            schools: [],
            offices: []
        };

        // --- ูุฏุฑุช ูุงูุจุฑ ---
        function showSection(id) {
            document.querySelectorAll('.main-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active-tab'));
            if(id === 'home') document.querySelector('.nav-menu .nav-link:nth-child(1)').classList.add('active-tab');

            window.scrollTo({top: 0, behavior: 'smooth'});

            if(id === 'school') updateSchoolProfile();
            if(id === 'office') updateOfficeProfile();
            if(id === 'stats') renderStatsTables();
        }

        function scrollToAwards() {
            showSection('home');
            setTimeout(() => {
                document.getElementById('awards-anchor').scrollIntoView({behavior: 'smooth'});
            }, 100);
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- ุงุณูุงุฏุฑ ุฌูุงุฒ ---
        let currentSlide = 0;
        const totalSlides = 4;
        let slideInterval;

        function initSlider() {
            if (slideInterval) clearInterval(slideInterval);
            slideInterval = setInterval(() => { changeSlide(1); }, 5000);
            updateSliderUI();
        }

        function changeSlide(direction) {
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            updateSliderUI();
            resetInterval();
        }

        function goToSlide(index) {
            currentSlide = index;
            updateSliderUI();
            resetInterval();
        }

        function resetInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(() => { changeSlide(1); }, 5000);
        }

        function updateSliderUI() {
            const container = document.getElementById('slidesContainer');
            const dots = document.querySelectorAll('.nav-dot');
            const slides = document.querySelectorAll('.award-slide');
            
            if(container) {
                container.style.transform = `translateX(${currentSlide * 100}%)`;
            }
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });

            slides.forEach((slide, index) => {
                if (index === currentSlide) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });
        }

        // --- ูุฏุฑุช ุงฺฉุณู ู ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง ---
        document.addEventListener('DOMContentLoaded', () => {
            setupExcelListeners();
            initSlider();
            // ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏู ุงููู (ููููู)
            processInitialData();
        });

        function setupExcelListeners() {
            document.getElementById('mainFile').addEventListener('change', (e) => processMainFile(e.target.files[0]));
        }

        // ุชุงุจุน ฺฉูฺฉ ุจุฑุง ูพุฑุฏุงุฒุด ุฏุงุฏู ุงููู (ุชุณุช)
        function processInitialData() {
            // ุฏุงุฏูโูุง ุชุณุช ุจุฑุง ุดุฑูุน
            appData.schools = [
                 { code: 'KER-23-01', name: 'ุฏุจุฑุณุชุงู ููููู ุงูุงู ุฑุถุง', weight: 280, rank: 1, regionCode: '23' },
                 { code: 'KER-23-02', name: 'ูุฏุฑุณู ุดูุฏุง', weight: 120, rank: 2, regionCode: '23' },
                 { code: 'KER-24-01', name: 'ููุฑุณุชุงู ูุฏุณ', weight: 600, rank: 1, regionCode: '24' } // ูุซุงู ุจุงูุง 500 ฺฉูู
            ];
            recalculateOffices();
            refreshAllData();
        }

        function processMainFile(file) {
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const workbook = XLSX.read(e.target.result, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet, {header: 1}); // ุฎูุงูุฏู ุจู ุตูุฑุช ุขุฑุงู ุจุฑุง ุฏุณุชุฑุณ ุจู ุณุชููโูุง
                
                // ูุฑุถ ุจุฑ ุงู ุงุณุช ฺฉู ูุงู ุงฺฉุณู 4 ุณุชูู ุฏุงุฑุฏ: ฺฉุฏ | ูุงู | ูุฒู | ุฑุชุจู
                // ุฑุฏู ุงูู ูุฏุฑ ุงุณุช
                const schoolsData = [];
                
                // ุดุฑูุน ุงุฒ ุฑุฏู ุฏูู (ุงูุฌุง ูุฑุถ ุจุฑ ุงู ุงุณุช ฺฉู ุฑุฏู ุงูู ุนููุงู ุงุณุช)
                for(let i = 1; i < json.length; i++) {
                    const row = json[i];
                    if(!row || row.length < 3) continue;

                    const code = String(row[0]).trim(); // ุณุชูู ุงูู: ฺฉุฏ
                    const name = row[1]; // ุณุชูู ุฏูู: ูุงู
                    const weight = parseFloat(row[2]) || 0; // ุณุชูู ุณูู: ูุฒู
                    
                    // ุชุดุฎุต ููุน ฺฉุฏ (KER-XX-YY ูุฏุฑุณู ุงุณุช)
                    // ุงูฺฏู ูุฏุฑุณู: ุดุฑูุน ุจุง KERุ ุฏู ุฑููุ ุฎุท ุชุฑูุ ุฏู ุฑูู
                    const schoolMatch = code.match(/^KER-(\d{2})-(\d{2})/i); // ูุซู KER-01-01
                    const simpleSchoolMatch = code.match(/^KER-(\d{2})/i); // ุงฺฏุฑ ูุฑูุช ุณุงุฏูโุชุฑ ุจูุฏ ูู ุจุงุฏ ูุฏุฑุณู ุจุงุดุฏ

                    if (schoolMatch) {
                        schoolsData.push({
                            code: code,
                            name: name,
                            weight: weight,
                            regionCode: schoolMatch[1], // ุงุณุชุฎุฑุงุฌ ฺฉุฏ ููุทูู (ูุซูุง 01)
                            rawRank: row[3] // ุณุชูู ฺูุงุฑู ุงฺฏุฑ ุจุงุดุฏ
                        });
                    }
                }
                
                if(schoolsData.length > 0) {
                    appData.schools = schoolsData;
                    
                    // ูุญุงุณุจู ุฑุชุจูโุจูุฏ ูุฏุงุฑุณ (ูุฑุชุจโุณุงุฒ ูุฒูู ุจุฑ ุงุณุงุณ ูุฒู)
                    appData.schools.sort((a,b) => b.weight - a.weight);
                    appData.schools.forEach((s, index) => s.rank = index + 1);

                    // ุชุฌูุน ุฏุงุฏูโูุง ุจุฑุง ุงุฏุงุฑุงุช
                    recalculateOffices();
                    
                    refreshAllData();
                    alert(`ุงุทูุงุนุงุช ุจุง ููููุช ุจุงุฑฺฏุฐุงุฑ ุดุฏ.\nุชุนุฏุงุฏ ูุฏุงุฑุณ: ${appData.schools.length}\nุชุนุฏุงุฏ ุงุฏุงุฑุงุช ุดูุงุณุง ุดุฏู: ${appData.offices.length}`);
                } else {
                    alert('ูฺ ุฏุงุฏู ูุนุชุจุฑ ุงูุช ูุดุฏ. ูุทูุง ูุฑูุช ูุงู (ฺฉุฏุ ูุงูุ ูุฒู) ุฑุง ุจุฑุฑุณ ฺฉูุฏ.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function recalculateOffices() {
            const officeMap = {};

            // ฺฏุฑููโุจูุฏ ูุฏุงุฑุณ ุจุฑ ุงุณุงุณ ฺฉุฏ ููุทูู
            appData.schools.forEach(school => {
                const rCode = school.regionCode;
                if(!officeMap[rCode]) {
                    officeMap[rCode] = {
                        regionCode: rCode,
                        name: regionNames[rCode] || `ุงุฏุงุฑู ฺฉุฏ ${rCode}`, // ุงุณุชูุงุฏู ุงุฒ ุฏฺฉุดูุฑ ูุงูโูุง
                        totalWeight: 0,
                        schoolCount: 0
                    };
                }
                officeMap[rCode].totalWeight += school.weight;
                officeMap[rCode].schoolCount += 1;
            });

            // ุชุจุฏู ููพ ุจู ุขุฑุงู
            appData.offices = Object.values(officeMap);
            
            // ูุฑุชุจโุณุงุฒ ุงุฏุงุฑุงุช ุจุฑ ุงุณุงุณ ูุฒู ฺฉู
            appData.offices.sort((a, b) => b.totalWeight - a.totalWeight);
            
            // ุชุนู ุฑุชุจู ุงุฏุงุฑุงุช
            appData.offices.forEach((o, index) => o.rank = index + 1);
        }

        function refreshAllData() {
            // ุจุฑูุฒุฑุณุงู ฺฉุงุฑุชโูุง ูุฑู
            const topSchool = appData.schools[0];
            const topOffice = appData.offices[0];
            
            // ูุฌููุน ฺฉู ุฏุฑุฎุชุงู ูุฌุงุช ุงูุชู ุฏุฑ ฺฉู ุงุณุชุงู
            const totalWeightAll = appData.schools.reduce((sum, s) => sum + s.weight, 0);
            const totalTrees = Math.floor(totalWeightAll / 500);

            document.getElementById('totalActiveSchools').innerText = appData.schools.length.toLocaleString();
            document.getElementById('totalTreesSaved').innerText = totalTrees.toLocaleString();

            if(topSchool) document.getElementById('topSchoolNameHero').innerText = topSchool.name.replace('ุฏุจุฑุณุชุงู ', '').replace('ูุฏุฑุณู ', '');
            if(topOffice) document.getElementById('topOfficeNameHero').innerText = topOffice.name.replace('ุงุฏุงุฑู ุขููุฒุด ู ูพุฑูุฑุด ', '');
            
            renderStatsTables();
            updateSchoolProfile(); // ุขูพุฏุช ูพุฑููุงู ุจุง ูุฏุฑุณู ุงูู ุจู ุนููุงู ูพุดโูุฑุถ
            updateOfficeProfile(); // ุขูพุฏุช ูพุฑููุงู ุจุง ุงุฏุงุฑู ุงูู
        }

        // --- ุฑูุฏุฑ ุฌุฏุงูู ุขูุงุฑ ---
        function renderStatsTables() {
            const schoolsBody = document.getElementById('schoolsTableBody');
            schoolsBody.innerHTML = '';
            
            // ููุงุด 50 ูุฏุฑุณู ุจุฑุชุฑ
            appData.schools.slice(0, 50).forEach((s, index) => {
                const tr = document.createElement('tr');
                const officeName = regionNames[s.regionCode] || s.regionCode;
                const treeProgress = s.weight >= 500 ? '๐ฒ ุฏุฑุฎุช ฺฉุงูู' : '๐ฑ ุฏุฑ ุญุงู ุฑุดุฏ';
                
                tr.innerHTML = `
                    <td><div class="rank-badge" style="${index === 0 ? 'background:#ffd700' : (index===1 ? 'background:#c0c0c0' : (index===2 ? 'background:#cd7f32' : 'background:#eee'))}">${index + 1}</div></td>
                    <td>${s.name}</td>
                    <td>${officeName}</td>
                    <td style="font-weight:bold; color:var(--primary-dark)">${s.weight}</td>
                    <td>${treeProgress}</td>
                `;
                schoolsBody.appendChild(tr);
            });

            const officesBody = document.getElementById('officesTableBody');
            officesBody.innerHTML = '';

            appData.offices.forEach((o, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><div class="rank-badge">${index + 1}</div></td>
                    <td>${o.name}</td>
                    <td>${o.schoolCount}</td>
                    <td style="font-weight:bold; color:var(--primary-dark)">${o.totalWeight}</td>
                    <td>${Math.floor(o.totalWeight / 500)} ุฏุฑุฎุช ฺฉุงูู</td>
                `;
                officesBody.appendChild(tr);
            });
        }

        // --- ุขูพุฏุช ูพุฑููุงู ูุฏุฑุณู (ููุทู ุฌุฏุฏ ุฏุฑุฎุช 500 ฺฉูู) ---
        function updateSchoolProfile() {
            // ูุนูุง ูุฏุฑุณู ุฑุชุจู 1 ุฑุง ูุดุงู ูุฏูุฏ (ุฏุฑ ูุณุฎู ูุงูุน ุจุงุฏ ูุงฺฏู ุจุงุดุฏ)
            const school = appData.schools[0];
            if(!school) return;

            const officeName = regionNames[school.regionCode] || school.regionCode;
            document.getElementById('schoolProfileName').innerText = school.name;
            document.getElementById('schoolProfileRegion').innerText = `${officeName} | ฺฉุฏ: ${school.code || '-'}`;
            
            const weight = school.weight;
            const target = 500; // ูุฏู ุฌุฏุฏ ุฏุฑุฎุช
            
            // ูุญุงุณุจุงุช ุฏุฑุฎุช
            const fullTrees = Math.floor(weight / target);
            const remainder = weight % target;
            const percent = Math.min(Math.round((remainder / target) * 100), 100);
            
            // ููุงุด ุถุฑุจ ุฏุฑุฎุช
            const badge = document.getElementById('treeMultiplierBadge');
            const statusText = document.getElementById('treeStatusText');
            
            if (fullTrees >= 1) {
                // ุงฺฏุฑ ุจุดุชุฑ ุงุฒ 500 ฺฉูู ุจูุฏ
                // ููุงุด ุถุฑุจุฏุฑ ุฏุฑุฎุช ุจุนุฏ (ูุซูุง ุงฺฏุฑ 700 ุชุงุณุชุ ุนู ุฏุฑุฎุช ุฏูู ุฏุฑ ุญุงู ุฑุดุฏ ุงุณุช -> x2)
                const currentTreeNumber = fullTrees + 1; 
                badge.style.display = 'block';
                badge.innerText = `x${currentTreeNumber}`; // ุฏุฑุฎุช ุถุฑุจุฏุฑ N
                statusText.innerText = `ุดฺฏูุชโุงูฺฏุฒ! ุดูุง ${fullTrees} ุฏุฑุฎุช ฺฉุงูู ฺฉุงุดุชูโุงุฏ ู ุฏุฑ ุญุงู ุชฺฉูู ุฏุฑุฎุช ${currentTreeNumber} ูุณุชุฏ.`;
            } else {
                badge.style.display = 'none';
                statusText.innerText = 'ุดูุง ุฏุฑ ุญุงู ูุฌุงุช ฺฉ ุฏุฑุฎุช ูุณุชุฏ!';
            }

            // ุงููุดู ุฏุงุฑู
            const circle = document.getElementById('schoolProgressCircle');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (percent / 100) * circumference;
            
            setTimeout(() => {
                circle.style.strokeDashoffset = offset;
                // ุงฺฏุฑ ุฏุฑุฎุช ฺฉุงูู ุดุฏูุ ุฏุฑุตุฏ ูพุฑ ุจูุฏู ุฏุฑุฎุช *ูุนู* ุฑุง ูุดุงู ุจุฏู (remainder)
                // ุงฺฏุฑ ุฏููุง 500 ุง 1000 ุจุงุดุฏุ ุฏุฑุตุฏ 0 (ุดุฑูุน ุจุนุฏ) ุง 100 (ุงุชูุงู ูุจู)ุ ูุนูููุง 0 ุจุฑุง ุจุนุฏ.
                // ุงฺฏุฑ 500 ฺฉูู ุจุงุดุฏ: fullTrees=1, remainder=0, percent=0.
                // ุงฺฏุฑ 700 ฺฉูู: fullTrees=1, remainder=200, percent=40.
                document.getElementById('schoolPercentText').innerText = (fullTrees > 0 && percent === 0) ? "100%" : percent + '%';
                // ุงุตูุงุญ: ุงฺฏุฑ ุฏููุง ุถุฑุจ 500 ุจุงุดุฏุ ุจฺฏูู ุฏุฑุฎุช ฺฉุงูู ุดุฏ.
                if (weight > 0 && weight % 500 === 0) {
                     badge.innerText = `x${fullTrees}`; // ููุงู ูุจู ฺฉุงูู ุดุฏู
                     document.getElementById('schoolPercentText').innerText = "100%";
                     circle.style.strokeDashoffset = 0; // ุฏุงุฑู ูพุฑ
                }
            }, 500);

            document.getElementById('schoolWeightText').innerText = weight + ' kg';
            document.getElementById('schoolRankText').innerText = school.rank;

            // ุงููุดู ูุงูโูุง ุฏุฑุฎุช
            for(let i=1; i<=5; i++) {
                const layer = document.getElementById(`sl-${i}`);
                layer.style.opacity = '0.3';
                layer.style.transform = 'translateX(-50%) scale(0.8)';
                
                // ูุงูโูุง ุจุฑ ุงุณุงุณ ุฏุฑุตุฏ ูพุฑ ูโุดููุฏ (ูุฑ 20 ุฏุฑุตุฏ ฺฉ ูุงู)
                if(percent >= i*20 || (weight > 0 && weight % 500 === 0)) {
                    setTimeout(() => {
                        layer.style.opacity = '1';
                        layer.style.transform = 'translateX(-50%) scale(1)';
                        layer.style.background = getComputedStyle(document.documentElement).getPropertyValue(`--primary-color`);
                    }, i * 300);
                }
            }
        }

        // --- ุขูพุฏุช ูพุฑููุงู ุงุฏุงุฑู ---
        function updateOfficeProfile() {
            const office = appData.offices[0];
            if(!office) return;

            document.getElementById('officeProfileName').innerText = office.name;
            document.getElementById('officeProfileStats').innerText = `ูุฏุงุฑุณ ูุนุงู: ${office.schoolCount} | ุฌูุน ฺฉู: ${office.totalWeight} kg`;
            
            const treeCount = Math.floor(office.totalWeight / 500);
            document.getElementById('officeTreeCount').innerText = treeCount;
            const avg = office.schoolCount > 0 ? Math.round(office.totalWeight / office.schoolCount) : 0;
            document.getElementById('officeAvgWeight').innerText = avg + ' kg';
            document.getElementById('officeRank').innerText = office.rank;

            const grid = document.getElementById('officeForestGrid');
            grid.innerHTML = '';
            
            const displayTrees = Math.min(treeCount, 50);
            
            for(let i=0; i<displayTrees; i++) {
                const div = document.createElement('div');
                div.className = 'forest-tree-item';
                div.innerText = '๐ฒ';
                div.style.animationDelay = (i * 0.05) + 's';
                grid.appendChild(div);
            }
            if(treeCount > 50) {
                const more = document.createElement('div');
                more.innerText = `+${treeCount - 50} ุจุดุชุฑ...`;
                more.style.gridColumn = '1 / -1';
                more.style.textAlign = 'center';
                more.style.color = 'var(--primary-dark)';
                grid.appendChild(more);
            }
        }

        // --- ุฎุฑูุฌ ุงฺฉุณู ---
        function exportData() {
            if (appData.schools.length === 0) {
                alert("ุฏุงุฏูโุง ุจุฑุง ุฎุฑูุฌ ฺฏุฑูุชู ูุฌูุฏ ูุฏุงุฑุฏ.");
                return;
            }

            // ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง ุจุฑุง ุงฺฉุณู
            const exportDataArray = appData.schools.map(s => ({
                "ฺฉุฏ": s.code,
                "ูุงู ูุฏุฑุณู": s.name,
                "ูุฒู (ฺฉููฺฏุฑู)": s.weight,
                "ุฑุชุจู ฺฉู": s.rank,
                "ูุงู ุงุฏุงุฑู": regionNames[s.regionCode] || s.regionCode
            }));

            const ws = XLSX.utils.json_to_sheet(exportDataArray);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Schools Data");

            // ุฏุงูููุฏ ูุงู
            XLSX.writeFile(wb, "Kerman_Green_Tree_Data.xlsx");
        }


        // --- ููุทู ุงููุช OTP ู EmailJS ---
        let generatedOTP = null;
        const ALLOWED_EMAIL = 'afsharmanesh.ehsan@gmail.com';

        function requestOTP() {
            const email = document.getElementById('emailInput').value.toLowerCase().trim();
            if (email !== ALLOWED_EMAIL) {
                alert('ุฏุณุชุฑุณ ุบุฑูุฌุงุฒ! ุงูู ูุงุฑุฏ ุดุฏู ุงุฌุงุฒู ูุฏุฑุช ูุฏุงุฑุฏ.');
                return;
            }

            generatedOTP = Math.floor(10000 + Math.random() * 90000);
            
            const sendBtn = document.querySelector('#emailStep .nav-btn');
            const originalText = sendBtn.innerText;
            sendBtn.innerText = 'ุฏุฑ ุญุงู ุงุฑุณุงู...';
            sendBtn.disabled = true;

            const templateParams = {
                to_email: email,
                otp_code: generatedOTP,
                message: generatedOTP,
                to_name: "ูุฏุฑ ูุญุชุฑู"
            };

            emailjs.send('service_0cbwqya', 'template_enjznsm', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    alert(`ฺฉุฏ ุชุงุฏ ุจู ุงูู ${email} ุงุฑุณุงู ุดุฏ.`);
                    
                    document.getElementById('emailStep').style.display = 'none';
                    document.getElementById('otpStep').style.display = 'block';
                }, function(error) {
                    console.log('FAILED...', error);
                    alert('ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงูู.');
                })
                .finally(() => {
                    sendBtn.innerText = originalText;
                    sendBtn.disabled = false;
                });
        }

        function verifyOTP() {
            const input = document.getElementById('otpInput').value;
            if (input == generatedOTP) {
                document.getElementById('loginCard').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
            } else {
                alert('ฺฉุฏ ูุงุฑุฏ ุดุฏู ุงุดุชุจุงู ุงุณุช.');
            }
        }

        function resetLogin() {
            document.getElementById('otpStep').style.display = 'none';
            document.getElementById('emailStep').style.display = 'block';
            document.getElementById('otpInput').value = '';
            generatedOTP = null;
        }

    </script>
</body>
</html>






