<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light">
    <title>ุทุฑุญ ุงุณุชุงู ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          // ุญุชูุงู ุงู ุจุฎุด ุฑุง ุจุง ฺฉูุฏ ุนููู EmailJS ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏ
          emailjs.init("VZYbSfsVjY-B4rsyE");
       })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">

    <style>
        /* --- ุชูุธูุงุช ูพุงู --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary-color: #2e7d32;
            --primary-dark: #1b5e20;
            --primary-light: #4caf50;
            --secondary-color: #ffd54f;
            --accent-color: #ff6f00;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --background: #f0fdf4;
            --white: #ffffff;
            --shadow-soft: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            /* ุงุฌุจุงุฑ ุฑูฺฏ ุฑูุดู ุจุฑุง ุญู ูุดฺฉู ูุฑูุฑฺฏุฑูุง ููุจุงู */
            background-color: var(--background) !important;
            color: var(--text-dark) !important;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- ููุงุฑ ูุงูุจุฑ --- */
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            position: fixed; top: 0; width: 100%; z-index: 1000;
            padding: 0.8rem 0; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .nav-container {
            max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .nav-logo { font-weight: 800; font-size: 1.4rem; color: var(--primary-dark); display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
        
        .nav-menu {
            display: flex; align-items: center; gap: 1.5rem;
            background: #f1f8e9 !important; padding: 0.5rem 1rem;
            border-radius: 50px; border: 1px solid #dcedc8;
        }

        .nav-link { 
            color: var(--text-dark); text-decoration: none; font-weight: 600; 
            font-size: 0.95rem; padding: 0.5rem 1rem; border-radius: 25px; 
            transition: all 0.3s; position: relative; cursor: pointer; white-space: nowrap;
        }
        .nav-link:hover { color: var(--primary-dark); background: rgba(76, 175, 80, 0.1); transform: translateY(-1px); }
        .nav-link.active-tab { background: var(--primary-color) !important; color: white !important; box-shadow: 0 4px 10px rgba(46,125,50,0.3); }
        
        .nav-btn { 
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)) !important; 
            color: white !important; padding: 0.6rem 1.8rem; border-radius: 25px; 
            border: none; cursor: pointer; font-family: inherit; font-weight: 700;
            box-shadow: 0 4px 15px rgba(27, 94, 32, 0.3); transition: all 0.3s; white-space: nowrap;
        }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(27, 94, 32, 0.4); }

        /* --- ุณุงุฎุชุงุฑ ฺฉู ุตูุญุงุช --- */
        .main-section { display: none; padding-top: 100px; min-height: 100vh; animation: fadeIn 0.6s ease; }
        .main-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

        /* --- ูุฑู (Hero) --- */
        .hero {
            background: radial-gradient(circle at 10% 20%, rgb(27, 94, 32) 0%, rgb(46, 125, 50) 90%);
            color: white; padding: 4rem 0 8rem; position: relative;
            border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;
            margin-top: -100px; padding-top: 180px;
        }
        .hero-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 4rem; align-items: center; }
        .hero-title { font-size: 3rem; font-weight: 900; line-height: 1.3; margin-bottom: 1.5rem; }
        .title-accent { display: block; color: var(--secondary-color); text-shadow: 0 0 20px rgba(255, 213, 79, 0.3); }
        .hero-desc { font-size: 1.1rem; opacity: 0.9; line-height: 1.8; margin-bottom: 2rem; max-width: 600px; }
        
        .stat-cards-hero { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 3rem; }
        .hero-stat-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 16px; padding: 1rem; text-align: center; transition: transform 0.3s; }
        .hero-stat-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.2); }
        .hero-stat-val { font-size: 1.5rem; font-weight: bold; display: block; margin-bottom: 0.2rem; }
        .hero-stat-lbl { font-size: 0.8rem; opacity: 0.8; }

        /* --- ุงููุดู ุฏุฑุฎุช ูุงู (Live Tree) --- */
        .tree-container-hero { position: relative; width: 300px; height: 350px; margin: 0 auto; }
        .live-tree-trunk { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 40px; height: 0; background: linear-gradient(90deg, #5D4037, #8D6E63); border-radius: 10px; z-index: 2; animation: growTrunk 1s forwards ease-out; }
        .live-tree-layer { position: absolute; left: 50%; transform: translateX(-50%) scale(0); border-radius: 50% 50% 50% 0; transform-origin: center bottom; box-shadow: 0 10px 20px rgba(0,0,0,0.2); opacity: 0; transition: all 1s ease-in-out; }
        
        .layer-1 { width: 220px; height: 90px; bottom: 60px; background: #2E7D32; z-index: 5; }
        .layer-2 { width: 180px; height: 80px; bottom: 110px; background: #388E3C; z-index: 6; }
        .layer-3 { width: 140px; height: 70px; bottom: 160px; background: #43A047; z-index: 7; }
        .layer-4 { width: 100px; height: 60px; bottom: 210px; background: #4CAF50; z-index: 8; }
        .layer-5 { width: 60px; height: 50px; bottom: 250px; background: #66BB6A; z-index: 9; }
        
        /* ฺฉูุงุณ ุจุฑุง ูุนุงู ุณุงุฒ ุงููุดู ุฑุดุฏ */
        .tree-layer-visible { transform: translateX(-50%) scale(1) !important; opacity: 1 !important; }
        .tree-layer-hidden { transform: translateX(-50%) scale(0) !important; opacity: 0 !important; }

        @keyframes growTrunk { to { height: 80px; } }

        /* --- ุจุฎุด ุฌุดู ู ุชุจุฑฺฉ (Celebration) --- */
        .celebration-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 20; display: none; overflow: hidden;
            border-radius: 16px;
        }
        
        /* ฺฉุงุบุฐ ุฑูฺฏ */
        .confetti {
            position: absolute; width: 10px; height: 10px; background-color: #f00;
            animation: confetti-fall 3s linear infinite;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
            100% { transform: translateY(300px) rotate(720deg); opacity: 0; }
        }

        /* ูพุฑูุฏู */
        .bird-fly {
            position: absolute; top: 20%; right: -50px;
            width: 40px; height: 40px;
            animation: fly-across 6s linear infinite;
        }
        @keyframes fly-across {
            0% { right: -50px; transform: translateY(0) scaleX(1); }
            50% { transform: translateY(-20px) scaleX(1); }
            100% { right: 110%; transform: translateY(0) scaleX(1); }
        }

        /* ุจฺูโูุง ุดุงุฏ */
        .dancing-kid {
            position: absolute; bottom: 10px; 
            width: 50px; height: 60px;
            animation: dance-jump 1s infinite alternate;
        }
        .kid-left { left: 20px; animation-delay: 0s; }
        .kid-right { right: 20px; animation-delay: 0.5s; }

        @keyframes dance-jump {
            0% { transform: translateY(0) rotate(-5deg); }
            100% { transform: translateY(-10px) rotate(5deg); }
        }

        /* --- ูุดุงูฺฏุฑ ุถุฑุจ ุฏุฑุฎุช --- */
        .tree-multiplier-badge {
            position: absolute; top: 10px; right: 10px;
            background: var(--secondary-color); color: var(--text-dark);
            font-weight: 900; padding: 5px 15px; border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 100; font-size: 1.2rem;
            animation: bounceIn 0.8s;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* --- ุจุฎุด ุฌูุงุฒ --- */
        .awards-section { padding: 0; position: relative; margin-top: -60px; margin-bottom: 4rem; z-index: 10; }
        .section-header-awards {
            text-align: center; margin-bottom: 2rem;
            display: table; margin: 0 auto;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: inline-block; padding: 1rem 2rem;
            border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            position: static; transform: none;
        }
        .section-header-awards h2 { font-size: 2rem; margin-bottom: 0.5rem; color: var(--primary-dark); }
        .section-header-awards p { opacity: 0.9; color: var(--primary-dark); font-weight: 500; }

        .awards-slider {
            max-width: 1000px; margin: 0 auto; position: relative; border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); background: var(--white);
            overflow: hidden; height: 450px;
        }
        .slides-container { display: flex; height: 100%; transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1); }
        .award-slide { min-width: 100%; height: 100%; position: relative; display: flex; align-items: flex-end; justify-content: center; overflow: hidden; }
        .slide-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; transition: transform 6s ease; }
        .award-slide.active .slide-bg { transform: scale(1.1); }
        .slide-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(27, 94, 32, 0.6) 50%, rgba(0,0,0,0.2) 100%); z-index: 1; }
        .award-content { position: relative; z-index: 2; text-align: center; padding: 3rem; color: white; width: 100%; transform: translateY(20px); opacity: 0; transition: all 0.5s ease 0.3s; }
        .award-slide.active .award-content { transform: translateY(0); opacity: 1; }
        .award-icon-box { width: 80px; height: 80px; background: var(--secondary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 1.5rem; box-shadow: 0 0 20px rgba(255, 213, 79, 0.6); border: 4px solid rgba(255,255,255,0.3); }
        .award-title { font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--secondary-color); }
        .award-description { font-size: 1.1rem; margin-bottom: 1.5rem; color: #e0e0e0; }
        .award-prize-tag { display: inline-block; background: rgba(255,255,255,0.15); backdrop-filter: blur(5px); border: 1px solid var(--secondary-color); padding: 0.8rem 2rem; border-radius: 50px; font-weight: bold; font-size: 1.1rem; color: white; }
        .slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px); border: none; color: white; font-size: 1.5rem; cursor: pointer; z-index: 10; transition: all 0.3s; }
        .slider-arrow:hover { background: var(--white); color: var(--primary-color); transform: translateY(-50%) scale(1.1); }
        .arrow-prev { right: 20px; }
        .arrow-next { left: 20px; }
        .slider-nav { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 0.8rem; z-index: 10; }
        .nav-dot { width: 12px; height: 12px; background: rgba(255, 255, 255, 0.4); border-radius: 50%; cursor: pointer; transition: all 0.3s; }
        .nav-dot.active { background: var(--secondary-color); width: 30px; border-radius: 10px; }

        /* --- ููุชุฑ --- */
        .footer { background: #1b1b1b !important; color: #fff !important; padding: 3rem 0; margin-top: 4rem; text-align: center; border-top: 5px solid var(--primary-color); }
        .footer-links { display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .footer-link { color: #ccc; text-decoration: none; font-size: 1rem; transition: color 0.3s; }
        .footer-link:hover { color: var(--secondary-color); }
        .footer-copy { border-top: 1px solid #333; padding-top: 1.5rem; font-size: 0.9rem; color: #888; }

        /* --- ุงุณุชุงู ูุดุชุฑฺฉ ุตูุญุงุช ุฏุงุฎู --- */
        .page-header { background: linear-gradient(135deg, var(--primary-dark), var(--primary-color)); color: white; padding: 3rem 0; border-radius: 20px; margin-bottom: 2rem; position: relative; overflow: hidden; box-shadow: var(--shadow-soft); }
        .page-header::after { content: ''; position: absolute; right: 0; bottom: 0; width: 300px; height: 300px; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='rgba(255, 255, 255, 0.1)' d='M44.7,-76.4C58.9,-69.2,71.8,-59.1,81.6,-46.6C91.4,-34.1,98.1,-19.2,95.8,-5.3C93.5,8.6,82.2,21.5,70.9,32.2C59.6,42.9,48.3,51.4,36.4,58.5C24.5,65.6,12,71.3,-1.2,73.4C-14.4,75.5,-29.8,74,-43.3,67.6C-56.8,61.2,-68.4,49.9,-76.3,36.4C-84.2,22.9,-88.4,7.2,-86.3,-7.5C-84.2,-22.2,-75.8,-35.9,-65.1,-46.8C-54.4,-57.7,-41.4,-65.8,-28.3,-73.6C-15.2,-81.4,-2,-88.9,12.2,-89.8C26.4,-90.7,40.8,-85,44.7,-76.4Z' transform='translate(100 100)' /%3E%3C/svg%3E") no-repeat bottom right; background-size: contain; }
        .stats-cards-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .modern-card { background: white !important; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; display: flex; flex-direction: column; align-items: center; position: relative; overflow: hidden; }
        .modern-card h3 { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .modern-card .value { font-size: 1.8rem; font-weight: bold; color: var(--primary-dark); }
        .modern-card .icon { font-size: 2rem; margin-bottom: 0.5rem; background: #e8f5e9; padding: 10px; border-radius: 50%; }
        .modern-table-container { background: white !important; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-x: auto; }
        .modern-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .modern-table th { text-align: right; padding: 1rem; color: var(--text-light); font-weight: 600; border-bottom: 2px solid #f0f0f0; }
        .modern-table td { padding: 1rem; border-bottom: 1px solid #f0f0f0; color: var(--text-dark); }
        .modern-table tr:hover { background: #f9fafb; }
        .rank-badge { background: var(--secondary-color); color: var(--primary-dark); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; }
        .tabs { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .tab-btn { padding: 0.8rem 2rem; border-radius: 50px; border: none; background: white !important; color: var(--text-light) !important; cursor: pointer; font-weight: 600; font-family: inherit; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: all 0.3s; }
        .tab-btn.active { background: var(--primary-color) !important; color: white !important; transform: translateY(-2px); box-shadow: 0 5px 15px (46,125,50,0.3); }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        /* --- ูพุฑููุงูโูุง --- */
        .school-profile-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .progress-circle-container { position: relative; width: 200px; height: 200px; margin: 0 auto; }
        .progress-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .progress-circle-bg { fill: none; stroke: #e0e0e0; stroke-width: 10; }
        /* ุฑุงูฺฉุงุฑ ณ: ุงููุดู ูุชููโุง ู ุชูพุด */
        .progress-circle-fg { 
            fill: none; stroke: var(--primary-color); stroke-width: 10; 
            stroke-dasharray: 565; stroke-dashoffset: 565; 
            transition: stroke-dashoffset 1.5s ease-out; stroke-linecap: round; 
            filter: drop-shadow(0 0 8px var(--primary-color));
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0% { filter: drop-shadow(0 0 5px var(--primary-color)); stroke: #2e7d32; }
            50% { filter: drop-shadow(0 0 15px #4caf50); stroke: #4caf50; }
            100% { filter: drop-shadow(0 0 5px var(--primary-color)); stroke: #2e7d32; }
        }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .forest-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; background: #e8f5e9; padding: 2rem; border-radius: 20px; min-height: 200px; max-height: 400px; overflow-y: auto; }
        .forest-tree-item { font-size: 2.5rem; text-align: center; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; transform: scale(0); }
        @keyframes popIn { to { opacity: 1; transform: scale(1); } }

        /* --- ูุฑู ุฏุณุชุฑุณ --- */
        .access-card { background: white !important; max-width: 400px; margin: 2rem auto; padding: 2rem; border-radius: 20px; box-shadow: var(--shadow-soft); text-align: center; }
        .access-input { width: 100%; padding: 1rem; border: 2px solid #eee; border-radius: 10px; margin: 1rem 0; font-family: inherit; outline: none; transition: border 0.3s; text-align: center; direction: ltr; }
        .access-input:focus { border-color: var(--primary-color); }
        .upload-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 2rem; }
        .upload-box { border: 2px dashed #cbd5e1; padding: 1.5rem; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: #f8fafc; }
        .upload-box:hover { border-color: var(--primary-color); background: #f0fdf4; }

        @media (max-width: 768px) {
            .navbar { padding: 0.5rem 0; }
            .nav-menu { overflow-x: auto; white-space: nowrap; padding: 0.5rem; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
            .nav-menu::-webkit-scrollbar { display: none; }
            .hero-content { grid-template-columns: 1fr; text-align: center; gap: 2rem; }
            .hero-content > div:first-child { order: 2; }
            .tree-container-hero { order: 1; transform: scale(0.9); margin: 0 auto; }
            .stat-cards-hero { grid-template-columns: 1fr 1fr; }
            .hero-title { font-size: 2rem; }
            .school-profile-grid { grid-template-columns: 1fr; }
            .stats-cards-row { grid-template-columns: 1fr; }
            .section-header-awards h2 { font-size: 1.5rem; }
            .awards-slider { height: 500px; }
            .award-content { padding: 1.5rem; }
            .award-title { font-size: 1.5rem; }
            .modern-table th, .modern-table td { padding: 0.8rem 0.5rem; font-size: 0.9rem; }
        }

    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo" onclick="showSection('home')">
                <span style="font-size: 1.8rem;">๐ณ</span>
                <span style="display: inline-block;">ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู</span>
            </div>
            <div class="nav-menu">
                <a class="nav-link active-tab" onclick="showSection('home')">ุฎุงูู</a>
                <a class="nav-link" onclick="scrollToAwards()">ุฌูุงุฒ</a>
                <a class="nav-link" onclick="showSection('stats')">ุขูุงุฑ ุงุณุชุงู</a>
                <a class="nav-link" onclick="showSection('school')">ูพุฑููุงู ูุฏุฑุณู</a>
                <a class="nav-link" onclick="showSection('office')">ูพุฑููุงู ุงุฏุงุฑู</a>
                <button class="nav-btn" onclick="showSection('access')">ูุฏุฑุช</button>
            </div>
        </div>
    </nav>

    <section id="home" class="main-section active">
        <div class="hero">
            <div class="container">
                <div class="hero-content">
                    <div>
                        <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                            ๐ฑ ุทุฑุญ ุฒุณุช ูุญุท ฑดฐด
                        </span>
                        <h1 class="hero-title">ูุฑ ูุฏุฑุณูุ ูุฌุงุช ฺฉ ุฏุฑุฎุช<span class="title-accent">ุขูุฏูโุง ุณุจุฒ ุจุฑุง ฺฉุฑูุงู</span></h1>
                        <p class="hero-desc">ุทุฑุญ ุจุฒุฑฺฏ ุฌูุนโุขูุฑ ูพุณูุงูุฏูุง ุจุง ุงุฑุฒุด ุฏุฑ ูุฏุงุฑุณ ุงุณุชุงู ฺฉุฑูุงู. ุจุง ูุดุงุฑฺฉุช ุฏุฑ ุงู ุทุฑุญุ ุนูุงูู ุจุฑ ุชุฌูุฒ ูุฏุฑุณู ุฎูุฏุ ุจู ุญูุธ ุฌูฺฏูโูุง ุงุฑุงู ฺฉูฺฉ ฺฉูุฏ.</p>
                        
                        <div class="stat-cards-hero">
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="totalActiveSchools">0</span>
                                <span class="hero-stat-lbl">ูุฏุฑุณู ูุนุงู</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="totalTreesSaved">0</span>
                                <span class="hero-stat-lbl">ุฏุฑุฎุช ูุฌุงุชโุงูุชู</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="topOfficeNameHero">-</span>
                                <span class="hero-stat-lbl">ุงุฏุงุฑู ุจุฑุชุฑ</span>
                            </div>
                            <div class="hero-stat-card">
                                <span class="hero-stat-val" id="topSchoolNameHero">-</span>
                                <span class="hero-stat-lbl">ูุฏุฑุณู ุจุฑุชุฑ</span>
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button class="nav-btn" style="background: var(--secondary-color); color: var(--primary-dark); font-weight: bold; padding: 1rem 2rem;" onclick="showSection('school')">ูุฑูุฏ ุจู ูพูู ูุฏุฑุณู</button>
                        </div>
                    </div>

                    <div class="tree-container-hero" id="homeTree">
                        <div class="live-tree-trunk"></div>
                        <div class="live-tree-layer layer-1" id="hl-1"></div>
                        <div class="live-tree-layer layer-2" id="hl-2"></div>
                        <div class="live-tree-layer layer-3" id="hl-3"></div>
                        <div class="live-tree-layer layer-4" id="hl-4"></div>
                        <div class="live-tree-layer layer-5" id="hl-5"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="awards-section" id="awards-anchor">
            <div class="container">
                <div class="section-header-awards">
                    <h2>ุฌุดููุงุฑู ุฌูุงุฒ ุจุฒุฑฺฏ ุณุจุฒ</h2>
                    <p>ุชูุฏุฑ ุงุฒ ุชูุงุดฺฏุฑุงู ุญูุธ ูุญุท ุฒุณุช ุจุง ุฌูุงุฒ ููุณ</p>
                </div>
                
                <div class="awards-slider" id="awardsSlider">
                    <div class="slides-container" id="slidesContainer">
                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1560785496-4c97b98d2c0b?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐ฅ๏ธ</div>
                                <h3 class="award-title">ุชุฌูุฒ ููุดููุฏ ูุฏุงุฑุณ</h3>
                                <p class="award-description">ุชุฎุชู ููุดููุฏุ ูุฏุฆู ูพุฑูฺฺฉุชูุฑ ู ููพโุชุงูพ ุจุฑุง ูุฏุงุฑุณ ุจุฑุชุฑ ุฏุฑ ุฌูุนโุขูุฑ ฺฉุงุบุฐ</p>
                                <div class="award-prize-tag">ูฺู ณ ูุฏุฑุณู ุงูู ุงุณุชุงู</div>
                            </div>
                        </div>
                        <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1517649763962-0c623066013b?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐ฒ</div>
                                <h3 class="award-title">ุชุฌูุฒุงุช ูุฑุฒุด ู ุณูุงูุช</h3>
                                <p class="award-description">ุงูุฏุง ุฏูฺุฑุฎู ฺฉููุณุชุงู ู ุณุช ฺฉุงูู ูุฑุฒุด ุจู ุฏุงูุดโุขููุฒุงู ูุนุงู</p>
                                <div class="award-prize-tag">ูุฑุนูโฺฉุด ุจู ตฐ ุฏุงูุดโุขููุฒ ุจุฑุชุฑ</div>
                            </div>
                        </div>
                         <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">โ๏ธ</div>
                                <h3 class="award-title">ุณูุฑ ุชูุฑุญ ุดูุงู</h3>
                                <p class="award-description">ุชูุฑ ด ุฑูุฒู ุชูุฑุญ ุจู ุงุณุชุงูโูุง ุดูุงู ุจุฑุง ฺฉุงุฏุฑ ุงุฌุฑุง ูุฏุงุฑุณ ููููู</p>
                                <div class="award-prize-tag">ูฺู ูุฏุฑุงู ู ูุนุงููู ุจุฑุชุฑ</div>
                            </div>
                        </div>
                         <div class="award-slide">
                            <div class="slide-bg" style="background-image: url('https://images.unsplash.com/photo-1627931398857-e685f4039365?q=80&w=1000&auto=format&fit=crop');"></div>
                            <div class="slide-overlay"></div>
                            <div class="award-content">
                                <div class="award-icon-box">๐</div>
                                <h3 class="award-title">ุชูุฏุณ ุฒุฑู ูุญุท ุฒุณุช</h3>
                                <p class="award-description">ูุดุงู ุฑุณู ู ุชูุฏุฑูุงูู ุจุง ุงูุถุง ูุฏุฑฺฉู ูุญุชุฑู + ุงุนุชุจุงุฑ ููุฏ</p>
                                <div class="award-prize-tag">ูุนุชุจุฑุชุฑู ูุดุงู ุงุณุชุงู</div>
                            </div>
                        </div>
                    </div>
                    <button class="slider-arrow arrow-prev" onclick="changeSlide(-1)">โฎ</button>
                    <button class="slider-arrow arrow-next" onclick="changeSlide(1)">โฏ</button>
                    <div class="slider-nav" id="sliderNav">
                        <div class="nav-dot active" onclick="goToSlide(0)"></div>
                        <div class="nav-dot" onclick="goToSlide(1)"></div>
                        <div class="nav-dot" onclick="goToSlide(2)"></div>
                        <div class="nav-dot" onclick="goToSlide(3)"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="stats" class="main-section">
        <div class="container">
            <div class="page-header">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <h1>ุขูุงุฑ ุฌุงูุน ุงุณุชุงู</h1>
                    <p>ฺฏุฒุงุฑุด ูุญุธูโุง ุนููฺฉุฑุฏ ูุฏุงุฑุณ ู ุงุฏุงุฑุงุช ุงุณุชุงู ฺฉุฑูุงู</p>
                </div>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('schools-rank')">ุฑุชุจูโุจูุฏ ูุฏุงุฑุณ</button>
                <button class="tab-btn" onclick="switchTab('offices-rank')">ุฑุชุจูโุจูุฏ ุงุฏุงุฑุงุช</button>
            </div>
            <div id="schools-rank" class="tab-content active">
                <div class="modern-table-container">
                    <table class="modern-table">
                        <thead><tr><th>ุฑุชุจู</th><th>ูุงู ูุฏุฑุณู</th><th>ููุทูู</th><th>ุฌูุนโุขูุฑ (kg)</th><th>ูุถุนุช</th></tr></thead>
                        <tbody id="schoolsTableBody"></tbody>
                    </table>
                </div>
            </div>
            <div id="offices-rank" class="tab-content">
                <div class="modern-table-container">
                    <table class="modern-table">
                        <thead><tr><th>ุฑุชุจู</th><th>ูุงู ุงุฏุงุฑู</th><th>ุชุนุฏุงุฏ ูุฏุงุฑุณ ูุนุงู</th><th>ฺฉู ุฌูุนโุขูุฑ (kg)</th><th>ุนููฺฉุฑุฏ</th></tr></thead>
                        <tbody id="officesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section id="school" class="main-section">
        <div class="container">
            <div class="page-header">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <span style="background: var(--secondary-color); color: var(--primary-dark); padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">ูพุฑููุงู ูุฏุฑุณู ุจุฑุชุฑ</span>
                    <h1 id="schoolProfileName" style="margin-top: 10px;">-</h1>
                    <p id="schoolProfileRegion">- | ฺฉุฏ: -</p>
                </div>
            </div>

            <div class="school-profile-grid">
                <div class="modern-card">
                    <h3>ูุถุนุช ุฏุฑุฎุช ูุฏุฑุณู</h3>
                    <div class="tree-container-hero" style="transform: scale(0.8); height: 280px; position: relative;">
                        <div id="treeMultiplierBadge" class="tree-multiplier-badge" style="display: none;"></div>
                        
                        <div id="celebrationOverlay" class="celebration-overlay">
                            <svg class="bird-fly" viewBox="0 0 100 100" fill="#333">
                                <path d="M10,50 Q25,25 40,50 T70,50" stroke="black" stroke-width="5" fill="none" />
                            </svg>
                            <svg class="dancing-kid kid-left" viewBox="0 0 50 100">
                                <circle cx="25" cy="15" r="10" fill="#ff6f00"/>
                                <line x1="25" y1="25" x2="25" y2="60" stroke="#ff6f00" stroke-width="5"/>
                                <line x1="25" y1="35" x2="5" y2="15" stroke="#ff6f00" stroke-width="5"/>
                                <line x1="25" y1="35" x2="45" y2="15" stroke="#ff6f00" stroke-width="5"/>
                                <line x1="25" y1="60" x2="10" y2="90" stroke="#ff6f00" stroke-width="5"/>
                                <line x1="25" y1="60" x2="40" y2="90" stroke="#ff6f00" stroke-width="5"/>
                            </svg>
                             <svg class="dancing-kid kid-right" viewBox="0 0 50 100">
                                <circle cx="25" cy="15" r="10" fill="#2e7d32"/>
                                <line x1="25" y1="25" x2="25" y2="60" stroke="#2e7d32" stroke-width="5"/>
                                <line x1="25" y1="35" x2="5" y2="15" stroke="#2e7d32" stroke-width="5"/>
                                <line x1="25" y1="35" x2="45" y2="15" stroke="#2e7d32" stroke-width="5"/>
                                <line x1="25" y1="60" x2="10" y2="90" stroke="#2e7d32" stroke-width="5"/>
                                <line x1="25" y1="60" x2="40" y2="90" stroke="#2e7d32" stroke-width="5"/>
                            </svg>
                        </div>

                        <div class="live-tree-trunk"></div>
                        <div class="live-tree-layer layer-1" id="sl-1"></div>
                        <div class="live-tree-layer layer-2" id="sl-2"></div>
                        <div class="live-tree-layer layer-3" id="sl-3"></div>
                        <div class="live-tree-layer layer-4" id="sl-4"></div>
                        <div class="live-tree-layer layer-5" id="sl-5"></div>
                    </div>
                    <p style="color: var(--primary-color); font-weight: bold; margin-top: 1rem;" id="treeStatusText">ุดูุง ุฏุฑ ุญุงู ูุฌุงุช ฺฉ ุฏุฑุฎุช ูุณุชุฏ!</p>
                </div>

                <div class="modern-card">
                    <div class="progress-circle-container">
                        <svg class="progress-svg">
                            <circle class="progress-circle-bg" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-circle-fg" id="schoolProgressCircle" cx="100" cy="100" r="90"></circle>
                        </svg>
                        <div class="progress-text">
                            <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-color);" id="schoolPercentText">0%</div>
                            <div style="color: #888; font-size: 0.9rem;">ูพุดุฑูุช (ุฏุฑุฎุช ูุนู)</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; margin-top: 2rem;">
                        <div style="text-align: center; background: #f9f9f9; padding: 1rem; border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: #888;">ูุฒู ุฌูุนโุขูุฑ ุดุฏู</div>
                            <div style="font-size: 1.2rem; font-weight: bold;" id="schoolWeightText">0 kg</div>
                        </div>
                        <div style="text-align: center; background: #f9f9f9; padding: 1rem; border-radius: 10px;">
                            <div style="font-size: 0.8rem; color: #888;">ุฑุชุจู ุฏุฑ ุงุณุชุงู</div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--secondary-color);" id="schoolRankText">-</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; width: 100%; padding: 1rem; background: #fff3cd; border-radius: 10px; font-size: 0.9rem; color: #856404;">
                        ๐ก <strong>ูฺฉุชู:</strong> ูุฑ ตฐฐ ฺฉููฺฏุฑู ฺฉุงุบุฐ ูุนุงุฏู ูุฌุงุช ฺฉ ุฏุฑุฎุช ุงุณุช.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="office" class="main-section">
        <div class="container">
            <div class="page-header" style="background: linear-gradient(135deg, #1b5e20, #004d40);">
                <div style="padding: 0 2rem; position: relative; z-index: 2;">
                    <span style="background: white; color: #004d40; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">ุงุฏุงุฑู ูพุดุชุงุฒ</span>
                    <h1 id="officeProfileName" style="margin-top: 10px;">-</h1>
                    <p id="officeProfileStats">ูุฏุงุฑุณ ูุนุงู: 0 | ฺฉู ฺฉุงุบุฐ: 0 kg</p>
                </div>
            </div>
            <div class="stats-cards-row">
                <div class="modern-card"><div class="icon">๐ฒ</div><h3>ุฌูฺฏู ุงุฌุงุฏ ุดุฏู</h3><div class="value" id="officeTreeCount">0</div></div>
                <div class="modern-card"><div class="icon">โ๏ธ</div><h3>ูุงูฺฏู ูุฑ ูุฏุฑุณู</h3><div class="value" id="officeAvgWeight">0 kg</div></div>
                <div class="modern-card"><div class="icon">๐ฅ</div><h3>ุฑุชุจู ุงุณุชุงู</h3><div class="value" id="officeRank">1</div></div>
            </div>
            <h2 style="margin: 2rem 0 1rem; color: var(--primary-dark);">ุฌูฺฏู ูุฌุงุฒ ุงุฏุงุฑู</h2>
            <div class="forest-grid" id="officeForestGrid"></div>
        </div>
    </section>

    <section id="access" class="main-section">
        <div class="container">
            <div class="access-card" id="loginCard">
                <h2 style="margin-bottom: 1rem;">ูุฑูุฏ ุงูู ูุฏุฑุงู</h2>
                <p style="color: #666; margin-bottom: 2rem;">ุจุฑุง ุฏุฑุงูุช ุฑูุฒ ุนุจูุฑ ฺฉุจุงุฑ ูุตุฑูุ ุงูู ูุฌุงุฒ ุฑุง ูุงุฑุฏ ฺฉูุฏ.</p>
                <div id="emailStep">
                    <input type="email" class="access-input" id="emailInput" placeholder="example@email.com">
                    <button class="nav-btn" onclick="requestOTP()" style="width: 100%; padding: 1rem;">ุงุฑุณุงู ฺฉุฏ ุชุงุฏ</button>
                </div>
                <div id="otpStep" style="display: none;">
                    <p style="color: var(--primary-color); font-weight: bold; margin-bottom: 10px;">ฺฉุฏ ุงุฑุณุงู ุดุฏู ุจู ุงูู ุฑุง ูุงุฑุฏ ฺฉูุฏ</p>
                    <input type="text" class="access-input" id="otpInput" placeholder="_ _ _ _ _" maxlength="5">
                    <button class="nav-btn" onclick="verifyOTP()" style="width: 100%; padding: 1rem;">ุชุงุฏ ู ูุฑูุฏ</button>
                    <button onclick="resetLogin()" style="margin-top: 1rem; background: none; border: none; color: #666; cursor: pointer; text-decoration: underline;">ุชุบุฑ ุงูู</button>
                </div>
            </div>
            <div id="adminPanel" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 2rem;">ูพูู ูุฏุฑุช ุฏุงุฏูโูุง</h2>
                <div class="upload-grid">
                    <div class="upload-box" onclick="document.getElementById('mainFile').click()">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">๐</div>
                        <h3>ุจุงุฑฺฏุฐุงุฑ ูุงู ฺฉู (ุงฺฉุณู)</h3>
                        <p style="color: #888; font-size: 0.9rem;">ุดุงูู ฺฉุฏุ ูุงู ูุฏุฑุณูุ ูุฒู ู ุฑุชุจู (ุชูฺฉฺฉ ุฎูุฏฺฉุงุฑ)</p>
                        <input type="file" id="mainFile" hidden accept=".xlsx, .xls">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                     <button class="nav-btn" onclick="exportData()" style="background: #1b5e20;">๐ฅ ุฎุฑูุฌ ุงฺฉุณู ุงุฒ ุณุงุช</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="#" onclick="showSection('home')" class="footer-link">ุตูุญู ุงุตู</a>
                <a href="#" onclick="showSection('stats')" class="footer-link">ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง</a>
                <a href="#" onclick="showSection('access')" class="footer-link">ูพูู ูุฏุฑุช</a>
                <a href="mailto:kermangreentree@gmail.com" class="footer-link">ุงุฑุชุจุงุท ุจุง ูุง</a>
            </div>
            <div class="footer-copy">&copy; ฑดฐด ุทุฑุญ ุงุณุชุงู ุฏุฑุฎุช ุณุจุฒ ฺฉุฑูุงู. ุชูุงู ุญููู ูุญููุธ ุงุณุช.</div>
        </div>
    </footer>

    <script>
        // --- ุฑุงูฺฉุงุฑ ด: ุงุชุตุงู ุจู ุฏุชุงุจุณ ุงุจุฑ (JSONBin) ---
        // ุจุฑุง ูุนุงู ุณุงุฒ ุงู ุจุฎุดุ ุจุงุฏ ุฏุฑ ุณุงุช jsonbin.io ุซุจุช ูุงู ฺฉูุฏ ู ููุงุฏุฑ ุฒุฑ ุฑุง ุฌุงฺฏุฒู ฺฉูุฏ.
        // ุชุง ุฒูุงู ฺฉู ุงู ููุงุฏุฑ ุฎุงู ุจุงุดูุฏุ ุณุงุช ุฑู ุญุงูุช "ููุงุด" (ููฺฉุงู) ฺฉุงุฑ ูโฺฉูุฏ.
        const JSONBIN_API_KEY = "$2a$10$XXXXXXXXXXXXXXXXXXXX"; // ฺฉูุฏ API ุฎูุฏ ุฑุง ุงูุฌุง ุจฺฏุฐุงุฑุฏ
        const JSONBIN_BIN_ID = "XXXXXXXXXXXX";   // ุดูุงุณู BIN ุฎูุฏ ุฑุง ุงูุฌุง ุจฺฏุฐุงุฑุฏ

        // --- ุฏฺฉุดูุฑ ูุงู ููุงุทู ---
        const regionNames = {
            "01": "ุงุฑุฒูุฆู", "02": "ุงูุงุฑ", "03": "ุจุงูุช", "04": "ุจุฑุฏุณุฑ", "05": "ุจู",
            "06": "ุฌุงุฒููุฑุงู", "07": "ุฌุฑูุช", "08": "ฺุชุฑูุฏ", "09": "ุฑุงุจุฑ", "10": "ุฑุงูุฑ",
            "11": "ุฑุงู", "12": "ุฑูุณูุฌุงู", "13": "ุฑูุฏุจุงุฑ ุฌููุจ", "14": "ุฑฺฏุงู", "15": "ุฒุฑูุฏ",
            "16": "ุณุฑุฌุงู", "17": "ุดูุฏุงุฏ", "18": "ุดูุฑุจุงุจฺฉ", "19": "ุนุดุงุฑ ฺฉุฑูุงู", "20": "ุนูุจุฑุขุจุงุฏ",
            "21": "ูุงุฑุงุจ", "22": "ููุฑุฌ", "23": "ููุน ฺฏูุฌ", "24": "ูุงุญู 1 ฺฉุฑูุงู", "25": "ูุงุญู 2 ฺฉุฑูุงู",
            "26": "ฺฉุดฺฉูุฆู", "27": "ฺฉููุจูุงู", "28": "ฺฉูููุฌ", "29": "ฺฏูุจุงู", "30": "ูุงูุงู",
            "31": "ูููุฌุงู", "32": "ูุฑูุงุดุฑ", "33": "ููู"
        };

        // --- ุฏุงุฏูโูุง ุจุฑูุงูู ---
        let appData = {
            schools: [],
            offices: []
        };

        // --- ุจุงุฑฺฏุฐุงุฑ ุงููู ---
        document.addEventListener('DOMContentLoaded', () => {
            setupExcelListeners();
            initSlider();
            loadDataFromCloud(); // ุชูุงุด ุจุฑุง ุฎูุงูุฏู ุงุฒ ูุถุง ุงุจุฑ
        });

        // --- ุชูุงุจุน ูุถุง ุงุจุฑ ---
        async function loadDataFromCloud() {
            // ุงฺฏุฑ ฺฉูุฏูุง ูุงุฑุฏ ูุดุฏู ุจุงุดูุฏุ ุงุฒ ุฏุชุง ูพุดโูุฑุถ ุงุณุชูุงุฏู ฺฉู
            if(JSONBIN_API_KEY.includes("XXXX")) {
                console.log("Using Local Demo Data (No Cloud Configured)");
                processInitialData(); // ุฏุชุง ุชุณุช
                return;
            }

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': JSONBIN_API_KEY }
                });
                if(response.ok) {
                    const result = await response.json();
                    appData = result.record;
                    refreshAllData();
                    console.log("Data loaded from Cloud!");
                } else {
                    console.warn("Cloud load failed, using demo data.");
                    processInitialData();
                }
            } catch (error) {
                console.error("Cloud Error:", error);
                processInitialData();
            }
        }

        async function saveDataToCloud(newData) {
            if(JSONBIN_API_KEY.includes("XXXX")) {
                alert("ุชูุฌู: ุฏุชุงุจุณ ุงุจุฑ ุชูุธู ูุดุฏู ุงุณุช. ุงุทูุงุนุงุช ููุท ุฏุฑ ูุฑูุฑฺฏุฑ ุดูุง ููุงุด ุฏุงุฏู ูโุดูุฏ ู ุจุฑุง ุฏฺฏุฑุงู ูุงุจู ุฑูุช ูุณุช.");
                return;
            }

            const loadingBtn = document.querySelector('#adminPanel button'); // ุฏฺฉูู ุฎุฑูุฌ ุฑุง ูููุชุง ุชุบุฑ ููุฏููุ ููุท ูุงฺฏ ูฺฉูู
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(newData)
                });
                
                if(response.ok) {
                    alert("โ ุงุทูุงุนุงุช ุจุง ููููุช ุฏุฑ ูุถุง ุงุจุฑ ุฐุฎุฑู ุดุฏ ู ุจุฑุง ููู ฺฉุงุฑุจุฑุงู ุจูโุฑูุฒ ุดุฏ.");
                } else {
                    alert("โ ุฎุทุง ุฏุฑ ุฐุฎุฑูโุณุงุฒ ุงุจุฑ.");
                }
            } catch (error) {
                alert("โ ุฎุทุง ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ.");
            }
        }


        // --- ูุฏุฑุช ูุงูุจุฑ ---
        function showSection(id) {
            document.querySelectorAll('.main-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active-tab'));
            if(id === 'home') document.querySelector('.nav-menu .nav-link:nth-child(1)').classList.add('active-tab');

            window.scrollTo({top: 0, behavior: 'smooth'});

            if(id === 'school') updateSchoolProfile(); // ุงุฌุฑุง ุงููุดู ููุดููุฏ
            if(id === 'office') updateOfficeProfile();
            if(id === 'stats') renderStatsTables();
        }

        function scrollToAwards() {
            showSection('home');
            setTimeout(() => {
                document.getElementById('awards-anchor').scrollIntoView({behavior: 'smooth'});
            }, 100);
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            event.target.closest('.tab-btn').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(el => {
                if(el !== event.target.closest('.tab-btn')) {
                    el.classList.remove('active');
                }
            });
        }

        // --- ุงุณูุงุฏุฑ ---
        let currentSlide = 0;
        const totalSlides = 4;
        let slideInterval;
        function initSlider() {
            if (slideInterval) clearInterval(slideInterval);
            slideInterval = setInterval(() => { changeSlide(1); }, 5000);
            updateSliderUI();
        }
        function changeSlide(direction) {
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            updateSliderUI();
            resetInterval();
        }
        function goToSlide(index) {
            currentSlide = index;
            updateSliderUI();
            resetInterval();
        }
        function resetInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(() => { changeSlide(1); }, 5000);
        }
        function updateSliderUI() {
            const container = document.getElementById('slidesContainer');
            const dots = document.querySelectorAll('.nav-dot');
            const slides = document.querySelectorAll('.award-slide');
            if(container) container.style.transform = `translateX(${currentSlide * 100}%)`;
            dots.forEach((dot, index) => dot.classList.toggle('active', index === currentSlide));
            slides.forEach((slide, index) => { if (index === currentSlide) slide.classList.add('active'); else slide.classList.remove('active'); });
        }

        // --- ูพุฑุฏุงุฒุด ุงฺฉุณู ---
        function setupExcelListeners() {
            document.getElementById('mainFile').addEventListener('change', (e) => processMainFile(e.target.files[0]));
        }

        function processInitialData() {
            // ุฏุงุฏูโูุง ุชุณุช ุงุตูุงุญ ุดุฏู ุจุฑุง ููุงุด ฺฉุงูู ุงููุดู ุฏุฑุฎุช (2500 ฺฉููฺฏุฑู = 5 ุฏุฑุฎุช)
            appData.schools = [
                 { code: 'KER-23-01', name: 'ุฏุจุฑุณุชุงู ููููู ุงูุงู ุฑุถุง', weight: 1000, rank: 1, regionCode: '23' }, 
                 { code: 'KER-23-02', name: 'ูุฏุฑุณู ุดูุฏุง', weight: 500, rank: 2, regionCode: '23' },
                 { code: 'KER-05-01', name: 'ูุฏุฑุณู ุดูุฏุงู', weight: 1000, rank: 3, regionCode: '05' }
            ];
            recalculateOffices();
            refreshAllData();
        }

        function processMainFile(file) {
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const workbook = XLSX.read(e.target.result, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet, {header: 1});
                
                const schoolsData = [];
                for(let i = 1; i < json.length; i++) {
                    const row = json[i];
                    if(!row || row.length < 3) continue;
                    const code = String(row[0]).trim();
                    const name = row[1];
                    const weight = parseFloat(row[2]) || 0;
                    const schoolMatch = code.match(/^KER-(\d{2})-(\d{2})/i); 
                    if (schoolMatch) {
                        schoolsData.push({
                            code: code, name: name, weight: weight,
                            regionCode: schoolMatch[1], rawRank: row[3]
                        });
                    }
                }
                if(schoolsData.length > 0) {
                    appData.schools = schoolsData;
                    appData.schools.sort((a,b) => b.weight - a.weight);
                    appData.schools.forEach((s, index) => s.rank = index + 1);
                    recalculateOffices();
                    refreshAllData();
                    saveDataToCloud(appData); // ุฐุฎุฑู ุฏุฑ ูุถุง ุงุจุฑ
                    alert(`ุงุทูุงุนุงุช ุจุง ููููุช ุจุงุฑฺฏุฐุงุฑ ู ุฐุฎุฑู ุดุฏ.`);
                } else {
                    alert('ูฺ ุฏุงุฏู ูุนุชุจุฑ ุงูุช ูุดุฏ.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function recalculateOffices() {
            const officeMap = {};
            appData.schools.forEach(school => {
                const rCode = school.regionCode;
                if(!officeMap[rCode]) {
                    officeMap[rCode] = {
                        regionCode: rCode, name: regionNames[rCode] || `ุงุฏุงุฑู ฺฉุฏ ${rCode}`,
                        totalWeight: 0, schoolCount: 0
                    };
                }
                officeMap[rCode].totalWeight += school.weight;
                officeMap[rCode].schoolCount += 1;
            });
            appData.offices = Object.values(officeMap);
            appData.offices.sort((a, b) => b.totalWeight - a.totalWeight);
            appData.offices.forEach((o, index) => o.rank = index + 1);
        }

        function refreshAllData() {
            const topSchool = appData.schools[0];
            const topOffice = appData.offices[0];
            const totalWeightAll = appData.schools.reduce((sum, s) => sum + s.weight, 0);
            // ูุญุงุณุจู ุชุนุฏุงุฏ ุฏุฑุฎุชุงู ฺฉู ุงุณุชุงู
            const totalTrees = Math.floor(totalWeightAll / 500);

            document.getElementById('totalActiveSchools').innerText = appData.schools.length.toLocaleString();
            document.getElementById('totalTreesSaved').innerText = totalTrees.toLocaleString();

            if(topSchool) document.getElementById('topSchoolNameHero').innerText = topSchool.name.replace('ุฏุจุฑุณุชุงู ', '').replace('ูุฏุฑุณู ', '');
            if(topOffice) document.getElementById('topOfficeNameHero').innerText = topOffice.name.replace('ุงุฏุงุฑู ุขููุฒุด ู ูพุฑูุฑุด ', '');
            
            renderStatsTables();
            // ุขูพุฏุช ูพุฑููุงูโูุง ูุนูุง ุจุง ุขุชู ุงูู
            if(appData.schools.length > 0) updateSchoolProfile(appData.schools[0]);
            if(appData.offices.length > 0) updateOfficeProfile();

            // --- ููุทู ุงุตูุงุญ ุดุฏู ุจุฑุง ุงููุดู ุฏุฑุฎุช ุตูุญู ุงุตู (Home) ---
            const homeTreeLayers = [
                document.getElementById('hl-1'), 
                document.getElementById('hl-2'), 
                document.getElementById('hl-3'), 
                document.getElementById('hl-4'), 
                document.getElementById('hl-5')
            ];

            // ููุงุด ุชุง 5 ูุงู ุจุฑ ุงุณุงุณ ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎุชุงู ูุฌุงุช ุงูุชู
            const layersToShow = Math.min(totalTrees, 5);
            let delay = 0;

            for(let i=0; i<5; i++) {
                const layer = homeTreeLayers[i];
                if (layer) {
                    layer.classList.remove('tree-layer-visible', 'tree-layer-hidden'); // ุฑุณุช
                    if (i < layersToShow) {
                        // ูุนุงู ุณุงุฒ ุจุง ุชุงุฎุฑ
                        setTimeout(() => {
                            layer.classList.add('tree-layer-visible');
                        }, delay);
                        delay += 300; // ุชุงุฎุฑ ุจู ูุฑ ูุงู
                    } else {
                        // ุบุฑ ูุนุงู ุณุงุฒ
                        layer.classList.add('tree-layer-hidden');
                    }
                }
            }
        }

        function renderStatsTables() {
            const schoolsBody = document.getElementById('schoolsTableBody');
            schoolsBody.innerHTML = '';
            appData.schools.slice(0, 50).forEach((s, index) => {
                const tr = document.createElement('tr');
                const officeName = regionNames[s.regionCode] || s.regionCode;
                const treeProgress = s.weight >= 500 ? '๐ฒ ุฏุฑุฎุช ฺฉุงูู' : '๐ฑ ุฏุฑ ุญุงู ุฑุดุฏ';
                tr.innerHTML = `<td><div class="rank-badge">${index + 1}</div></td><td>${s.name}</td><td>${officeName}</td><td style="font-weight:bold; color:var(--primary-dark)">${s.weight}</td><td>${treeProgress}</td>`;
                schoolsBody.appendChild(tr);
            });
            const officesBody = document.getElementById('officesTableBody');
            officesBody.innerHTML = '';
            appData.offices.forEach((o, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><div class="rank-badge">${index + 1}</div></td><td>${o.name}</td><td>${o.schoolCount}</td><td style="font-weight:bold; color:var(--primary-dark)">${o.totalWeight}</td><td>${Math.floor(o.totalWeight / 500)} ุฏุฑุฎุช ฺฉุงูู</td>`;
                officesBody.appendChild(tr);
            });
        }

        // --- ุงููุดู ููุดููุฏ ุฏุฑุฎุช ูุฏุฑุณู (ุงุตูุงุญ ุดุฏู) ---
        function updateSchoolProfile(school = appData.schools[0]) {
            if(!school) return;
            const officeName = regionNames[school.regionCode] || school.regionCode;
            document.getElementById('schoolProfileName').innerText = school.name;
            document.getElementById('schoolProfileRegion').innerText = `${officeName} | ฺฉุฏ: ${school.code || '-'}`;
            document.getElementById('schoolWeightText').innerText = school.weight + ' kg';
            document.getElementById('schoolRankText').innerText = school.rank;

            const target = 500;
            const weight = school.weight;
            const fullTrees = Math.floor(weight / target);
            const remainder = weight % target;
            const percent = Math.min(Math.round((remainder / target) * 100), 100);

            // 1. ุฑุณุช ฺฉุฑุฏู ุงููุดู ุฏุฑุฎุช (ููู ุฎุงููุด)
            for(let i=1; i<=5; i++) {
                const layer = document.getElementById(`sl-${i}`);
                layer.classList.remove('tree-layer-visible');
                layer.classList.add('tree-layer-hidden');
            }

            // 2. ููุงุด ูุงูุน ุจุฑ ุงุณุงุณ ูุฒู
            let layersToShow = 0;
            // ุงฺฏุฑ ฺฉ ุฏุฑุฎุช ฺฉุงูู ุดุฏุ 5 ูุงู ููุงุด ุฏุงุฏู ุดูุฏ.
            if (weight >= target) layersToShow = 5; 
            // ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุจู ุงุฒุง ูุฑ 20 ุฏุฑุตุฏ ฺฉ ูุงู (ูุฑ 100 ฺฉูู = 1 ูุงู)
            else layersToShow = Math.floor(percent / 20); 

            // ุงฺฏุฑ ูุฒู > 0 ูู ฺฉูุชุฑ ุงุฒ 100 ฺฉูู ูุณุชุ ุญุฏุงูู ฺฉ ูุงู ฺฉูฺฺฉ ูุดุงู ุจุฏู
            if (weight > 0 && layersToShow === 0) layersToShow = 1;

            for(let i=1; i<=layersToShow; i++) {
                setTimeout(() => {
                    document.getElementById(`sl-${i}`).classList.remove('tree-layer-hidden');
                    document.getElementById(`sl-${i}`).classList.add('tree-layer-visible');
                }, i * 300); // ุงููุดู ุฑุดุฏ ูุงูโุง
            }


            // 3. ูุฏุฑุช ุฌุดู ู ูุดุงูฺฏุฑ
            const badge = document.getElementById('treeMultiplierBadge');
            const statusText = document.getElementById('treeStatusText');
            const celebration = document.getElementById('celebrationOverlay');
            
            // ุงุถุงูู ฺฉุฑุฏู ฺฉุงุบุฐ ุฑูฺฏ
            if (fullTrees >= 1) {
                 celebration.style.display = 'block';
                 // ุงุฌุงุฏ ุฐุฑุงุช ฺฉุงุบุฐ ุฑูฺฏ ุงฺฏุฑ ูุจูุง ุณุงุฎุชู ูุดุฏูุฏ
                 if(celebration.querySelectorAll('.confetti').length === 0) {
                     for(let k=0; k<20; k++) {
                         let conf = document.createElement('div');
                         conf.className = 'confetti';
                         conf.style.left = Math.random() * 100 + '%';
                         conf.style.animationDelay = Math.random() * 2 + 's';
                         conf.style.backgroundColor = ['#f00', '#0f0', '#00f', '#ff0'][Math.floor(Math.random()*4)];
                         celebration.appendChild(conf);
                     }
                 }
                 
                 badge.style.display = 'block';
                 badge.innerText = `x${fullTrees}`;
                 statusText.innerText = `ุชุจุฑฺฉ! ${fullTrees} ุฏุฑุฎุช ฺฉุงูู ูุฌุงุช ุฏุงุฏูโุงุฏ!`;
                 
            } else {
                celebration.style.display = 'none';
                badge.style.display = 'none';
                statusText.innerText = 'ุดูุง ุฏุฑ ุญุงู ูุฌุงุช ฺฉ ุฏุฑุฎุช ูุณุชุฏ!';
            }

            // ุงููุดู ุฏุงุฑู
            const circle = document.getElementById('schoolProgressCircle');
            const circumference = 2 * Math.PI * 90;
            // ุงฺฏุฑ ุฏุฑุฎุช ฺฉุงูู ุดุฏ (500kg) ู ุจุงู ูุงูุฏู ุตูุฑ ุงุณุชุ ุฏุงุฑู ุจุงุฏ ฺฉุงูู ุจุงุดุฏ (offset 0)
            const offset = circumference - (percent / 100) * circumference;
            
            setTimeout(() => {
                circle.style.strokeDashoffset = (fullTrees >= 1 && remainder === 0) ? 0 : offset;
                // ุงฺฏุฑ ุฏุฑุฎุช ฺฉุงูู ุจูุฏุ ุฏุฑุตุฏ ุฑุง 100% ููุงุด ุจุฏูุ ุญุช ุงฺฏุฑ ุจุงู ูุงูุฏู ุตูุฑ ุจุงุดุฏ
                document.getElementById('schoolPercentText').innerText = (fullTrees >= 1 && remainder === 0) ? "100%" : percent + '%';
            }, 500);
        }

        function updateOfficeProfile() {
            const office = appData.offices[0];
            if(!office) return;
            document.getElementById('officeProfileName').innerText = office.name;
            document.getElementById('officeProfileStats').innerText = `ูุฏุงุฑุณ ูุนุงู: ${office.schoolCount} | ุฌูุน ฺฉู: ${office.totalWeight} kg`;
            const treeCount = Math.floor(office.totalWeight / 500);
            document.getElementById('officeTreeCount').innerText = treeCount;
            const avg = office.schoolCount > 0 ? Math.round(office.totalWeight / office.schoolCount) : 0;
            document.getElementById('officeAvgWeight').innerText = avg + ' kg';
            document.getElementById('officeRank').innerText = office.rank;
            const grid = document.getElementById('officeForestGrid');
            grid.innerHTML = '';
            const displayTrees = Math.min(treeCount, 50);
            for(let i=0; i<displayTrees; i++) {
                const div = document.createElement('div');
                div.className = 'forest-tree-item';
                div.innerText = '๐ฒ';
                div.style.animationDelay = (i * 0.05) + 's';
                grid.appendChild(div);
            }
            if(treeCount > 50) {
                const more = document.createElement('div'); more.innerText = `+${treeCount - 50} ุจุดุชุฑ...`; more.style.gridColumn = '1 / -1'; more.style.textAlign = 'center'; more.style.color = 'var(--primary-dark)'; grid.appendChild(more);
            }
        }

        function exportData() {
            if (appData.schools.length === 0) { alert("ุฏุงุฏูโุง ูุฌูุฏ ูุฏุงุฑุฏ."); return; }
            const exportDataArray = appData.schools.map(s => ({ "ฺฉุฏ": s.code, "ูุงู ูุฏุฑุณู": s.name, "ูุฒู": s.weight, "ุฑุชุจู": s.rank, "ุงุฏุงุฑู": regionNames[s.regionCode] || s.regionCode }));
            const ws = XLSX.utils.json_to_sheet(exportDataArray);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Schools Data");
            XLSX.writeFile(wb, "Green_Tree_Data.xlsx");
        }

        // --- ุงููุช OTP ---
        let generatedOTP = null;
        const ALLOWED_EMAIL = 'afsharmanesh.ehsan@gmail.com';
        function requestOTP() {
            const email = document.getElementById('emailInput').value.toLowerCase().trim();
            if (email !== ALLOWED_EMAIL) { alert('ุฏุณุชุฑุณ ุบุฑูุฌุงุฒ!'); return; }
            generatedOTP = Math.floor(10000 + Math.random() * 90000);
            const sendBtn = document.querySelector('#emailStep .nav-btn');
            const originalText = sendBtn.innerText;
            sendBtn.innerText = 'ุฏุฑ ุญุงู ุงุฑุณุงู...'; sendBtn.disabled = true;
            const templateParams = { to_email: email, otp_code: generatedOTP, message: generatedOTP, to_name: "ูุฏุฑ ูุญุชุฑู" };
            // SERVICE ID ู TEMPLATE ID ุฎูุฏ ุฑุง ุญุชูุง ุฌุงฺฏุฒู ฺฉูุฏ (ุฏุฑ ุงูุฌุง ฺฉุฏูุง ุชุณุช ูุฑุงุฑ ุฏุงุฑูุฏ)
            emailjs.send('service_0cbwqya', 'template_enjznsm', templateParams)
                .then(function(r) { alert(`ฺฉุฏ ุชุงุฏ ุงุฑุณุงู ุดุฏ.`); document.getElementById('emailStep').style.display = 'none'; document.getElementById('otpStep').style.display = 'block'; }, function(e) { alert('ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงูู.'); })
                .finally(() => { sendBtn.innerText = originalText; sendBtn.disabled = false; });
        }
        function verifyOTP() {
            if (document.getElementById('otpInput').value == generatedOTP) { document.getElementById('loginCard').style.display = 'none'; document.getElementById('adminPanel').style.display = 'block'; } else alert('ฺฉุฏ ุงุดุชุจุงู ุงุณุช.');
        }
        function resetLogin() { document.getElementById('otpStep').style.display = 'none'; document.getElementById('emailStep').style.display = 'block'; document.getElementById('otpInput').value = ''; generatedOTP = null; }
    </script>
</body>
</html>
